
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modules and scripts &#8212; Practice and theory of brain imaging</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Where does Python look for modules?" href="sys_path.html" />
    <link rel="prev" title="Voxels and time" href="voxels_by_time.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/reggie.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Practice and theory of brain imaging</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Practice and theory of brain imaging
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The neuroimaging problem
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="the_problem.html">
   The problem and the plan
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The tools
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="to_code.html">
   Ode to code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="surviving_computers.html">
   Surviving the computer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="the_software.html">
   Our tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="using_jupyter.html">
   Using Jupyter notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="more_on_jupyter.html">
   More on the Jupyter notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="brisk_python.html">
   Brisk introduction to Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   Installing on your computer
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Images and code and images
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="what_is_an_image.html">
   What is an image?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_intro.html">
   Introduction to Numpy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arrays_and_images.html">
   Arrays as images, images as arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arrays_3d.html">
   Three-dimensional arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="images_3d.html">
   Three-dimensional images, NIfTI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reshape_and_3d.html">
   Reshaping and three-dimensional arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boolean_indexing.html">
   Indexing with Boolean arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boolean_indexing_nd.html">
   Boolean indexing with more than one dimension
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_to_4d.html">
   Working with four dimensional images, masks and functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reshape_and_4d.html">
   Reshaping, 4D to 2D
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="voxels_by_time.html">
   Voxels and time
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Working reproducibly
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Modules and scripts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sys_path.html">
   Where does Python look for modules?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assert.html">
   Using
   <code class="docutils literal notranslate">
    <span class="pre">
     assert
    </span>
   </code>
   for testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="path_manipulation.html">
   Making and breaking file paths in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coding_style.html">
   Python coding style
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="docstrings.html">
   Docstrings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="module_directories.html">
   Module directories
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="on_testing.html">
   On testing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Arrays and plots
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="methods_vs_functions.html">
   Methods vs functions in NumPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="allclose.html">
   Testing for near equality with “allclose”
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arange.html">
   NumPy arange
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_logical.html">
   Logical operations on Boolean arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dot_outer.html">
   Vector and matrix dot products, “np.outer”
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newaxis.html">
   Adding length 1 dimensions with newaxis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="array_reductions.html">
   Array reduction operations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_random.html">
   Random numbers with
   <code class="docutils literal notranslate">
    <span class="pre">
     np.random
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="subtract_means.html">
   Subtracting the mean from columns or rows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot_lines.html">
   Plotting lines in matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="subplots.html">
   Subplots and axes in matplotlib
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Into the fourth dimension
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="voxel_time_courses.html">
   Voxel time courses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="otsu_threshold.html">
   Otsu’s method for binarizing images
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Coordinate systems and spatial transforms
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="diagonal_zooms.html">
   Encoding zooms (scaling) with a diagonal matrix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nibabel_affines.html">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     nibabel.affines
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nibabel_apply_affine.html">
   Applying coordinate transforms with
   <code class="docutils literal notranslate">
    <span class="pre">
     nibabel.affines.apply_affine
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="map_coordinates.html">
   General resampling between images with
   <code class="docutils literal notranslate">
    <span class="pre">
     scipy.ndimage.map_coordinates
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="image_header_and_affine.html">
   The image header and affine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="images_and_affines.html">
   Images and affines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rotation_2d_3d.html">
   Rotations and rotation matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="resampling_with_ndimage.html">
   Resampling with
   <code class="docutils literal notranslate">
    <span class="pre">
     scipy.ndimage
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dipy_registration.html">
   Registration with dipy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="anterior_cingulate.html">
   Anterior cingulate
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistics and the general linear model
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="mean_test_example.html">
   A worked example of the general linear model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hypothesis_tests.html">
   Hypothesis testing with the general linear model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="convolution_background.html">
   Convolving with the hemodyamic response function
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model_one_voxel.html">
   Modeling a single voxel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="test_one_voxel.html">
   Testing a single voxel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_multiply.html">
   Estimation for many voxels at the same time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="non_tr_onsets.html">
   Using onsets that do not start on a TR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="whole_image_statistics.html">
   Whole-brain t tests and p values
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/on_modules.Rmd"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.Rmd</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/nipraxis/textbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/nipraxis/textbook/issues/new?title=Issue%20on%20page%20%2Fon_modules.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/nipraxis/textbook/main?urlpath=tree/on_modules.Rmd"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://hub.nipraxis.org/hub/user-redirect/git-pull?repo=https://github.com/nipraxis/textbook&urlpath=tree/textbook/on_modules.Rmd&branch=main"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#back-from-trying-some-more-data">
   Back from trying some more data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-the-module-reloading">
   Changing the module, reloading
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#on-scripts">
   On scripts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-name-main-trick">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     __name___
    </span>
    <span class="pre">
     ==
    </span>
    <span class="pre">
     "__main__"
    </span>
   </code>
   trick
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#command-line-arguments">
   Command line arguments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#see-also">
   See also
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Modules and scripts</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#back-from-trying-some-more-data">
   Back from trying some more data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#changing-the-module-reloading">
   Changing the module, reloading
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#on-scripts">
   On scripts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-name-main-trick">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     __name___
    </span>
    <span class="pre">
     ==
    </span>
    <span class="pre">
     "__main__"
    </span>
   </code>
   trick
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#command-line-arguments">
   Command line arguments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#see-also">
   See also
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="modules-and-scripts">
<h1>Modules and scripts<a class="headerlink" href="#modules-and-scripts" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Operating system utilities</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Usual imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
</pre></div>
</div>
</div>
</div>
<p>We get a 4D volume to work on:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the function to fetch the data file we need.</span>
<span class="kn">import</span> <span class="nn">nipraxis</span>
<span class="c1"># Fetch the data file.</span>
<span class="n">data_fname</span> <span class="o">=</span> <span class="n">nipraxis</span><span class="o">.</span><span class="n">fetch_file</span><span class="p">(</span><span class="s1">&#39;ds107_sub012_t1r2.nii&#39;</span><span class="p">)</span>
<span class="c1"># Show the file name of the fetched data.</span>
<span class="n">data_fname</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading file &#39;ds107_sub012_t1r2.nii&#39; from &#39;https://raw.githubusercontent.com/nipraxis/nipraxis-data/0.3/ds107_sub012_t1r2.nii&#39; to &#39;/home/runner/.cache/nipraxis/0.3&#39;.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/home/runner/.cache/nipraxis/0.3/ds107_sub012_t1r2.nii&#39;
</pre></div>
</div>
</div>
</div>
<p>Let’s say I have a function that loads a 4D image, and returns a list with
mean values across all voxels in each volume:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">vol_means</span><span class="p">(</span><span class="n">image_fname</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">image_fname</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vol</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>For extra points</strong>: can you work out a better way to do the same thing
without a loop?</p>
<p>First we check the <code class="docutils literal notranslate"><span class="pre">vol_means</span></code> function works:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_means</span> <span class="o">=</span> <span class="n">vol_means</span><span class="p">(</span><span class="n">data_fname</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">my_means</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fae936a6820&gt;]
</pre></div>
</div>
<img alt="_images/on_modules_7_1.png" src="_images/on_modules_7_1.png" />
</div>
</div>
<p>We are interested in outlier detection.  Let’s make a routine to detect
outliers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">detect_outliers</span><span class="p">(</span><span class="n">some_values</span><span class="p">,</span> <span class="n">n_stds</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">overall_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">overall_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">overall_std</span> <span class="o">*</span> <span class="n">n_stds</span>
    <span class="n">is_outlier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">some_values</span> <span class="o">-</span> <span class="n">overall_mean</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">thresh</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_outlier</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outlier_inds</span> <span class="o">=</span> <span class="n">detect_outliers</span><span class="p">(</span><span class="n">my_means</span><span class="p">)</span>
<span class="n">outlier_inds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  6,  12,  49,  50,  69, 165])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_means</span><span class="p">[</span><span class="n">outlier_inds</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([363.11401367, 362.87746233, 355.6257952 , 357.68177316,
       362.3819894 , 370.37314453])
</pre></div>
</div>
</div>
</div>
<p>These seem like useful functions.</p>
<p>We decide we’d like to use these in another notebook.</p>
<p>Off we go and copy / paste these functions into <a class="reference internal" href="using_module.html"><span class="doc std std-doc">another
notebook</span></a></p>
<p>Go there, and have a look at how it does on some more data.</p>
<div class="section" id="back-from-trying-some-more-data">
<h2>Back from trying some more data<a class="headerlink" href="#back-from-trying-some-more-data" title="Permalink to this headline">¶</a></h2>
<p>We found that the there is a mistake in the copy/pasted code.</p>
<p>Of course we could fix it here, and then go and fix it in the other notebook.</p>
<p>But, a better way, is:</p>
<ul class="simple">
<li><p>Put the code in one place, for both notebooks to use</p></li>
<li><p>Fix it in one place, and</p></li>
<li><p>Test the code!  (More on this later).</p></li>
</ul>
<p>A Python <em>module</em> is a Python file with functions (and variables and other
things) that other modules and scripts may use. These other modules and scripts
will <code class="docutils literal notranslate"><span class="pre">import</span></code> the module.</p>
<p>The simplest possible <em>module</em> is just a file with a <code class="docutils literal notranslate"><span class="pre">.py</span></code> extension, with
Python code.</p>
<p>In the cell below, I’m using the notebook machinery to write some context to a
text file called <code class="docutils literal notranslate"><span class="pre">vol_means.py</span></code> in the current working directory, with a
<code class="docutils literal notranslate"><span class="pre">%%file</span></code> Jupyter <em>magic</em> command at the top of the cell.</p>
<p>Usually we would write the file with our text editor.  You will very rarely need or use the <code class="docutils literal notranslate"><span class="pre">%%file</span></code> magic; it is really only useful for demonstration notebooks like this one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> volmeans.py
<span class="sd">&quot;&quot;&quot; File to calculate volume means, detect outliers</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>

<span class="k">def</span> <span class="nf">vol_means</span><span class="p">(</span><span class="n">image_fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate volume means from 4D image `image_fname`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">image_fname</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vol</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">detect_outliers_fixed</span><span class="p">(</span><span class="n">some_values</span><span class="p">,</span> <span class="n">n_stds</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">overall_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">overall_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">overall_std</span> <span class="o">*</span> <span class="n">n_stds</span>
    <span class="n">is_outlier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">some_values</span> <span class="o">-</span> <span class="n">overall_mean</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">thresh</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_outlier</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting volmeans.py
</pre></div>
</div>
</div>
</div>
<p>We now have a file in the current directory called <code class="docutils literal notranslate"><span class="pre">volmeans.py</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;volmeans.py&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>We can use this new <em>module</em> very simply - by <code class="docutils literal notranslate"><span class="pre">import</span></code>ing it, as we have
imported other modules and libraries:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">volmeans</span>
</pre></div>
</div>
</div>
</div>
<p>As with other modules, you can explore the functions and data available in this module by making a new cell, and typing <code class="docutils literal notranslate"><span class="pre">volmean.</span></code> followed by the tab key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment to try exploring the volmeans module.</span>
<span class="c1"># volmeans.</span>
</pre></div>
</div>
</div>
</div>
<p>Now we find that the functions defined in the module are attached to the imported module, <code class="docutils literal notranslate"><span class="pre">volmeans</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">means_again</span> <span class="o">=</span> <span class="n">volmeans</span><span class="o">.</span><span class="n">vol_means</span><span class="p">(</span><span class="n">data_fname</span><span class="p">)</span>
<span class="n">volmeans</span><span class="o">.</span><span class="n">detect_outliers_fixed</span><span class="p">(</span><span class="n">means_again</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  6,  12,  49,  50,  69, 165])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="changing-the-module-reloading">
<span id="reload"></span><h2>Changing the module, reloading<a class="headerlink" href="#changing-the-module-reloading" title="Permalink to this headline">¶</a></h2>
<p>Usually, when we write a module, we import it into the notebook and use it, without need to change the module.</p>
<p>But sometimes, if you are developing interactively, you find you want to edit the module file and rerun the code in the module.</p>
<p>Let us simulate that process now, by writing a new, very simple module file,
with a <code class="docutils literal notranslate"><span class="pre">print</span></code> at the end of the module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> simplemod.py

<span class="k">def</span> <span class="nf">double_me</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Result of double_me on 2&#39;</span><span class="p">,</span> <span class="n">double_me</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing simplemod.py
</pre></div>
</div>
</div>
</div>
<p>Now, when we <code class="docutils literal notranslate"><span class="pre">import</span></code> the module, Python executes the code in the module, which first, <em>defines</em> the <code class="docutils literal notranslate"><span class="pre">double_me</span></code> function and then <code class="docutils literal notranslate"><span class="pre">print</span></code>s the result.  So, when we <code class="docutils literal notranslate"><span class="pre">import</span></code>, we see the printed result, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">simplemod</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Result of double_me on 2 4
</pre></div>
</div>
</div>
</div>
<p>Now let’s imagine we are still in the same Python session. For example, imagine, as is the case for us now, we are using the same Jupyter kernel.  But we want to rewrite the module to print out the result for a more interesting number.</p>
<p><strong>Note</strong> We would normally edit the module in our text editor, but here we’re
using <code class="docutils literal notranslate"><span class="pre">%%file</span></code> again to simulate that process of editing and writing the file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> simplemod.py

<span class="k">def</span> <span class="nf">double_me</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Result of double_me on 13&#39;</span><span class="p">,</span> <span class="n">double_me</span><span class="p">(</span><span class="mi">13</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting simplemod.py
</pre></div>
</div>
</div>
</div>
<p>Then we run the <code class="docutils literal notranslate"><span class="pre">import</span></code> again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">simplemod</span>
</pre></div>
</div>
</div>
</div>
<p>Oh dear - Python hasn’t picked up the new version of the file.  In fact, it
isn’t printing anything - it isn’t running the print statement at all — from
the previous version or from the new version.</p>
<p>This is due to the mechanism Python uses to <code class="docutils literal notranslate"><span class="pre">import</span></code> the file.  When Python
does an <code class="docutils literal notranslate"><span class="pre">import</span></code> it first tries a <em>shortcut</em>, and only if that fails, does it
load and run the code from the file.  The process is:</p>
<ol class="simple">
<li><p><strong>Shortcut</strong>: Python first checks if it already has the defined module, and
returns that if so, otherwise;</p></li>
<li><p><strong>Long way round</strong>: Python reads the text file and runs the code inside.</p></li>
</ol>
<p>In the case above, our second <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">simplemod</span></code> triggers the shortcut, where
Python already has the module, so it returns the code from that module.  That
is the code that existed the first time we did <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">simplemod</span></code>, so we get
the result of the long way round load of the original code.</p>
<p>Usually Python’s mechanism is what we want, because we usually don’t find
ourselves editing Python modules after we have imported them, in the same
Python session.  In the common case, where we haven’t edited the module, but
we are importing it again, the shortcut saves a lot of time.</p>
<p>For the rare case where we do edit the module while the Python process is
running, we can force the long way round, using a <code class="docutils literal notranslate"><span class="pre">reload</span></code>, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Library to execute the importing logic.</span>
<span class="kn">import</span> <span class="nn">importlib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trigger long-way-round import of module.</span>
<span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">simplemod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Result of double_me on 13 26
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;module &#39;simplemod&#39; from &#39;/home/runner/work/textbook/textbook/simplemod.py&#39;&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="on-scripts">
<h2>On scripts<a class="headerlink" href="#on-scripts" title="Permalink to this headline">¶</a></h2>
<p>Let us return to the diagnostics problem, and <code class="docutils literal notranslate"><span class="pre">volmeans.py</span></code>.</p>
<p>It is good that we can <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">volmeans</span></code> and use it in Python, but we would
really like to be able to use this file as a <em>script</em> that we can run from
the terminal command line.  We would like to be able to run the following
command, from the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">volmeans</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>In our ideal world, this would print out the outliers for the scan
<code class="docutils literal notranslate"><span class="pre">ds107_sub012_t1r2.nii</span></code>.</p>
<p>We can do this very simply, by adding some stuff to the end of the module.
The addition is the <code class="docutils literal notranslate"><span class="pre">print</span></code> statement at the end of the module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> volmeans.py
<span class="sd">&quot;&quot;&quot; File to calculate volume means, detect outliers</span>

<span class="sd">Also, print out mean values.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">nipraxis</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>

<span class="kn">import</span> <span class="nn">nipraxis</span>


<span class="k">def</span> <span class="nf">vol_means</span><span class="p">(</span><span class="n">image_fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate volume means from 4D image `image_fname`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">image_fname</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vol</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">detect_outliers_fixed</span><span class="p">(</span><span class="n">some_values</span><span class="p">,</span> <span class="n">n_stds</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">overall_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">overall_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">overall_std</span> <span class="o">*</span> <span class="n">n_stds</span>
    <span class="n">is_outlier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">some_values</span> <span class="o">-</span> <span class="n">overall_mean</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">thresh</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_outlier</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="c1"># The new stuff:</span>
<span class="n">data_fname</span> <span class="o">=</span> <span class="n">nipraxis</span><span class="o">.</span><span class="n">fetch_file</span><span class="p">(</span><span class="s1">&#39;ds107_sub012_t1r2.nii&#39;</span><span class="p">)</span>
<span class="n">means</span> <span class="o">=</span> <span class="n">vol_means</span><span class="p">(</span><span class="n">data_fname</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">detect_outliers_fixed</span><span class="p">(</span><span class="n">means</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting volmeans.py
</pre></div>
</div>
</div>
</div>
<p>Now we can <em>execute</em> the <code class="docutils literal notranslate"><span class="pre">.py</span></code> file from the command line, to give the effect
we want.</p>
<p>Normally, to show this, you would open a terminal and type <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">volmeans.py</span></code>.  Here though, we will use the notebook <code class="docutils literal notranslate"><span class="pre">!</span></code> prefix to ask the notebook to execute code <em>in the terminal</em>.  So, the notebook code below has exactly the same effect as typing <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">volmeans.py</span></code> at the terminal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Notice the ! at the beginning of the line below.</span>
<span class="c1"># This tells the notebook to execute the command in a terminal.</span>
<span class="o">!</span>python3 volmeans.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[  6  12  49  50  69 165]
</pre></div>
</div>
</div>
</div>
<p>There is another way to <em>execute</em> a Python file like this in a notebook,
which is to use the Jupyter <code class="docutils literal notranslate"><span class="pre">%run</span></code> command.  This is particularly useful,
because we do not need to specify, for example, <code class="docutils literal notranslate"><span class="pre">python3</span></code>, because we are using
the Python session running inside the notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> volmeans.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[  6  12  49  50  69 165]
</pre></div>
</div>
</div>
</div>
<p>This is what we wanted, but…</p>
</div>
<div class="section" id="the-name-main-trick">
<h2>The <code class="docutils literal notranslate"><span class="pre">__name___</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> trick<a class="headerlink" href="#the-name-main-trick" title="Permalink to this headline">¶</a></h2>
<p>With the <code class="docutils literal notranslate"><span class="pre">print</span></code> at the end of our module, we have an annoying problem when we
<code class="docutils literal notranslate"><span class="pre">import</span></code>.  As you remember, we have to <code class="docutils literal notranslate"><span class="pre">reload</span></code> the module to see the new
changes on import, but when we do…:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">volmeans</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[  6  12  49  50  69 165]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;module &#39;volmeans&#39; from &#39;/home/runner/work/textbook/textbook/volmeans.py&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>Oh dear, we were doing the <code class="docutils literal notranslate"><span class="pre">import</span></code> to get access to the code, and it’s an annoying waste now, to calculate and print out the mean values when we do the import.</p>
<p>What we would really like to be able to do, is to calculate and print out the
values, <em>only</em> when we are <em>executing</em> the module as a script, and <em>not</em> when
we are <code class="docutils literal notranslate"><span class="pre">import</span></code>ing the module to use the code.</p>
<p>Luckily Python gives us a way to tell whether the code is being run as part of a script or an <code class="docutils literal notranslate"><span class="pre">import</span></code>.</p>
<p>Before Python starts executing the code in the file, it sets a special variable, called <code class="docutils literal notranslate"><span class="pre">__name__</span></code>, that differs in the case of the executed script and the imported module.</p>
<p>Specifically:</p>
<ul class="simple">
<li><p>When <em>importing</em> the code, the <code class="docutils literal notranslate"><span class="pre">__name__</span></code> variable has a value that is a
string containing the name of the module.  In our case, when running <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">volmeans</span></code>, <code class="docutils literal notranslate"><span class="pre">__name__</span></code> is the string <code class="docutils literal notranslate"><span class="pre">'volmeans'</span></code>.</p></li>
<li><p>When <em>executing</em> the code, the <code class="docutils literal notranslate"><span class="pre">__name__</span></code> variable has the value
<code class="docutils literal notranslate"><span class="pre">'__main__'</span></code>.</p></li>
</ul>
<p>See <a class="reference internal" href="dunders.html"><span class="doc std std-doc">two underscores</span></a> for more.</p>
<p>When you do want to use your <code class="docutils literal notranslate"><span class="pre">.py</span></code> file <em>both</em> as a script, <em>and</em> for
importing, you often see this pattern at the bottom of the <code class="docutils literal notranslate"><span class="pre">.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># We only get here if running the file as a script</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I am running as a script&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://docs.python.org/3/library/__main__.html">if <strong>name</strong> ==
‘<strong>main</strong>’</a> in the Python
documentation.</p>
<p>Now we can solve our problem using the <code class="docutils literal notranslate"><span class="pre">volmeans.py</span></code> for importing and as a script, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> volmeans.py
<span class="sd">&quot;&quot;&quot; File to calculate volume means, detect outliers</span>

<span class="sd">Also, print out mean values (only if running as a script).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>

<span class="kn">import</span> <span class="nn">nipraxis</span>


<span class="k">def</span> <span class="nf">vol_means</span><span class="p">(</span><span class="n">image_fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate volume means from 4D image `image_fname`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">image_fname</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vol</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">detect_outliers_fixed</span><span class="p">(</span><span class="n">some_values</span><span class="p">,</span> <span class="n">n_stds</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">overall_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">overall_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">overall_std</span> <span class="o">*</span> <span class="n">n_stds</span>
    <span class="n">is_outlier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">some_values</span> <span class="o">-</span> <span class="n">overall_mean</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">thresh</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_outlier</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="c1"># The new stuff:</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># The code is running as a script.</span>
    <span class="n">data_fname</span> <span class="o">=</span> <span class="n">nipraxis</span><span class="o">.</span><span class="n">fetch_file</span><span class="p">(</span><span class="s1">&#39;ds107_sub012_t1r2.nii&#39;</span><span class="p">)</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">vol_means</span><span class="p">(</span><span class="n">data_fname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">detect_outliers_fixed</span><span class="p">(</span><span class="n">means</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting volmeans.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We do print out the values when running as a script:</span>
<span class="o">%</span><span class="k">run</span> volmeans.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[  6  12  49  50  69 165]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We don&#39;t print the values when (re)importing:</span>
<span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">volmeans</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;module &#39;volmeans&#39; from &#39;/home/runner/work/textbook/textbook/volmeans.py&#39;&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="command-line-arguments">
<h2>Command line arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h2>
<p>When you run a script, you can also pass command line arguments, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">my_script</span><span class="o">.</span><span class="n">py</span> <span class="n">a_string</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">my_script.py</span></code> is the script, and <code class="docutils literal notranslate"><span class="pre">a_string</span></code> is the command line
argument.</p>
<p>You can do the same thing from within Jupyter / IPython:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">my_script</span><span class="o">.</span><span class="n">py</span> <span class="n">a_string</span>
</pre></div>
</div>
<p>In your script, you can get the command line arguments from the <code class="docutils literal notranslate"><span class="pre">argv</span></code>
list within the <code class="docutils literal notranslate"><span class="pre">sys</span></code> module.  The first element of the <code class="docutils literal notranslate"><span class="pre">sys.argv</span></code> list is
always the name of the program – in our case this will be <code class="docutils literal notranslate"><span class="pre">my_script.py</span></code>.
The second and subsequent entries in <code class="docutils literal notranslate"><span class="pre">sys.argv</span></code> are the arguments entered at
the command line.  For example, in our case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;my_script.py&#39;</span><span class="p">,</span> <span class="s1">&#39;a_string&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The entries in this list are always strings.  For <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">my_script.py</span> <span class="pre">1</span></code>
you would get:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;my_script.py&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>For example, to make <code class="docutils literal notranslate"><span class="pre">volmeans.py</span></code> more useful, we might want to pass a Nipraxis filename to the script, to get it to print out the means for any Nipraxis file, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%file</span> volmeans.py
<span class="sd">&quot;&quot;&quot; File to calculate volume means, detect outliers</span>

<span class="sd">When run as a script, print out values for given Nipraxis file.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># New import of sys.</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>

<span class="kn">import</span> <span class="nn">nipraxis</span>

<span class="k">def</span> <span class="nf">vol_means</span><span class="p">(</span><span class="n">image_fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate volume means from 4D image `image_fname`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">image_fname</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vol</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">detect_outliers_fixed</span><span class="p">(</span><span class="n">some_values</span><span class="p">,</span> <span class="n">n_stds</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">overall_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">overall_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">some_values</span><span class="p">)</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">overall_std</span> <span class="o">*</span> <span class="n">n_stds</span>
    <span class="n">is_outlier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">some_values</span> <span class="o">-</span> <span class="n">overall_mean</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">thresh</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_outlier</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># New: using sys to get first argument.</span>
    <span class="n">nipraxis_fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">data_fname</span> <span class="o">=</span> <span class="n">nipraxis</span><span class="o">.</span><span class="n">fetch_file</span><span class="p">(</span><span class="n">nipraxis_fname</span><span class="p">)</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">vol_means</span><span class="p">(</span><span class="n">data_fname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">detect_outliers_fixed</span><span class="p">(</span><span class="n">means</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting volmeans.py
</pre></div>
</div>
</div>
</div>
<p>Now we can run the script like this to print out the original set of means:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print out the values for ds107_sub012_t1r2.nii</span>
<span class="o">%</span><span class="k">run</span> volmeans.py ds107_sub012_t1r2.nii
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[  6  12  49  50  69 165]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>We can also print out the mean values for any other Nipraxis file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print out the values for ds114_sub009_t2r1.nii</span>
<span class="o">%</span><span class="k">run</span> volmeans.py ds114_sub009_t2r1.nii
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://docs.python.org/3/tutorial/modules.html">Modules</a> in the standard
Python tutorial.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "nipraxis/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="voxels_by_time.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Voxels and time</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="sys_path.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Where does Python look for modules?</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By The nipraxis team<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>