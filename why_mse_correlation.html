
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Why the correlation gives the best slope &#8212; Practice and theory of brain imaging</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/reggie.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Practice and theory of brain imaging</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Practice and theory of brain imaging
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The neuroimaging problem
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="the_problem.html">
   The problem and the plan
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The tools
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="to_code.html">
   Ode to code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="surviving_computers.html">
   Surviving the computer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="the_software.html">
   Our tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="using_jupyter.html">
   Using Jupyter notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="more_on_jupyter.html">
   More on the Jupyter notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="brisk_python.html">
   Brisk introduction to Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   Installing on your computer
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Images and code and images
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="pathlib.html">
   Using the
   <code class="docutils literal notranslate">
    <span class="pre">
     pathlib
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="what_is_an_image.html">
   What is an image?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_intro.html">
   Introduction to Numpy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boolean_arrays.html">
   Boolean arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reshape_and_2d.html">
   Two-dimensions, reshaping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arrays_and_images.html">
   Arrays as images, images as arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arrays_3d.html">
   Three-dimensional arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="images_3d.html">
   Three-dimensional images, NIfTI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reshape_and_3d.html">
   Reshaping and three-dimensional arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boolean_indexing.html">
   Indexing with Boolean arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boolean_indexing_nd.html">
   Boolean indexing with more than one dimension
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_to_4d.html">
   Working with four dimensional images, masks and functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reshape_and_4d.html">
   Reshaping, 4D to 2D
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="voxels_by_time.html">
   Voxels and time
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Working reproducibly
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="on_modules.html">
   Modules and scripts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sys_path.html">
   Where does Python look for modules?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assert.html">
   Using
   <code class="docutils literal notranslate">
    <span class="pre">
     assert
    </span>
   </code>
   for testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coding_style.html">
   Python coding style
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="docstrings.html">
   Docstrings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="module_directories.html">
   Module directories
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="on_testing.html">
   On testing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Detecting activation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="voxel_time_courses.html">
   Correlating with voxel time courses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="on_convolution.html">
   Convolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="convolution_background.html">
   Convolving with the hemodyamic response function
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="on_regression.html">
   Introducing regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regress_one_voxel.html">
   Regression for a single voxel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regression_notation.html">
   Notation for regression models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="glm_intro.html">
   Introduction to the general linear model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mean_test_example.html">
   A worked example of the general linear model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model_one_voxel.html">
   Modeling a single voxel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_multiply.html">
   Estimation for many voxels at the same time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hypothesis_tests.html">
   Hypothesis testing with the general linear model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="test_one_voxel.html">
   Testing a single voxel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="non_tr_onsets.html">
   Using onsets that do not start on a TR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="whole_image_statistics.html">
   Whole-brain t tests and p values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bonferroni_correction.html">
   Notes on the Bonferroni threshold
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Spatial processing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="slice_timing.html">
   Slice timing correction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optimizing_space.html">
   Calculating transformations between images
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="diagonal_zooms.html">
   Encoding zooms (scaling) with a diagonal matrix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nibabel_affines.html">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     nibabel.affines
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nibabel_apply_affine.html">
   Applying coordinate transforms with
   <code class="docutils literal notranslate">
    <span class="pre">
     nibabel.affines.apply_affine
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="map_coordinates.html">
   General resampling between images with
   <code class="docutils literal notranslate">
    <span class="pre">
     scipy.ndimage.map_coordinates
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="image_header_and_affine.html">
   The image header and affine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="images_and_affines.html">
   Images and affines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rotation_2d_3d.html">
   Rotations and rotation matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="resampling_with_ndimage.html">
   Resampling with
   <code class="docutils literal notranslate">
    <span class="pre">
     scipy.ndimage
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dipy_registration.html">
   Registration with dipy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="anterior_cingulate.html">
   Anterior cingulate
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notes on arrays and plots
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="methods_vs_functions.html">
   Methods vs functions in NumPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="allclose.html">
   Testing for near equality with “allclose”
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arange.html">
   NumPy arange
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_logical.html">
   Logical operations on Boolean arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dot_outer.html">
   Vector and matrix dot products, “np.outer”
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newaxis.html">
   Adding length 1 dimensions with newaxis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="array_reductions.html">
   Array reduction operations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_random.html">
   Numpy random number generators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="subtract_means.html">
   Subtracting the mean from columns or rows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot_lines.html">
   Plotting lines in matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="subplots.html">
   Subplots and axes in matplotlib
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/nipraxis/textbook/main?urlpath=tree/why_mse_correlation.Rmd"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://hub.nipraxis.org/hub/user-redirect/git-pull?repo=https%3A//github.com/nipraxis/textbook&urlpath=tree/textbook/why_mse_correlation.Rmd&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/nipraxis/textbook/blob/main/why_mse_correlation.Rmd"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fnipraxis%2Ftextbook%2Fblob%2Fmain%2Fwhy_mse_correlation.Rmd"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Deepnote"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_deepnote.svg">
  </span>
<span class="headerbtn__text-container">Deepnote</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/nipraxis/textbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/nipraxis/textbook/issues/new?title=Issue%20on%20page%20%2Fwhy_mse_correlation.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/why_mse_correlation.Rmd"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.Rmd</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-example-regression-problem">
   The example regression problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-sums">
   Writing sums
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mean-and-standard-deviation">
   Mean and standard deviation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-z-score-transformation">
   The z-score transformation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correlation">
   Correlation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sum-of-squared-error-for-z-scored-lines">
   Sum of squared error for z-scored lines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-interesting-characteristics-of-z-scores">
   Some interesting characteristics of z-scores
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#addition-inside-sum">
     Addition inside sum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiplication-by-constant-inside-sum">
     Multiplication by constant inside sum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sum-of-constant-value">
     Sum of constant value
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#characteristics-of-z-scores">
   Characteristics of z-scores
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-least-squares-line-for-z-scores">
   The least-squares line for z-scores
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reality-check">
   Reality check
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-the-trough-in-the-sse-function">
   Finding the trough in the SSE function
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Why the correlation gives the best slope</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-example-regression-problem">
   The example regression problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-sums">
   Writing sums
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mean-and-standard-deviation">
   Mean and standard deviation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-z-score-transformation">
   The z-score transformation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correlation">
   Correlation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sum-of-squared-error-for-z-scored-lines">
   Sum of squared error for z-scored lines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#some-interesting-characteristics-of-z-scores">
   Some interesting characteristics of z-scores
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#addition-inside-sum">
     Addition inside sum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiplication-by-constant-inside-sum">
     Multiplication by constant inside sum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sum-of-constant-value">
     Sum of constant value
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#characteristics-of-z-scores">
   Characteristics of z-scores
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-least-squares-line-for-z-scores">
   The least-squares line for z-scores
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reality-check">
   Reality check
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-the-trough-in-the-sse-function">
   Finding the trough in the SSE function
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="why-the-correlation-gives-the-best-slope">
<h1>Why the correlation gives the best slope<a class="headerlink" href="#why-the-correlation-gives-the-best-slope" title="Permalink to this headline">#</a></h1>
<p>In which we return to the <a class="reference internal" href="on_regression.html"><span class="doc std std-doc">simple regression</span></a> problem, and
work through the mathematics to show why the correlation is the best
least-squares slope for two z-scored arrays.</p>
<p>As background, you may also want to read the <a class="reference internal" href="regression_notation.html"><span class="doc std std-doc">regression
notation</span></a> page.</p>
<section id="the-example-regression-problem">
<h2>The example regression problem<a class="headerlink" href="#the-example-regression-problem" title="Permalink to this headline">#</a></h2>
<p>As you remember, we have (fake) measured scores for a “psychopathy” personality
trait in 12 students. We also have a measure of how much sweat each student had
on their palms, and we call this a “clammy” score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import numerical and plotting libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="k">as</span> <span class="nn">npl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># Only show 6 decimals when printing</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psychopathy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">11.416</span><span class="p">,</span> <span class="mf">4.514</span><span class="p">,</span> <span class="mf">12.204</span><span class="p">,</span> <span class="mf">14.835</span><span class="p">,</span>
                        <span class="mf">8.416</span><span class="p">,</span>  <span class="mf">6.563</span><span class="p">,</span> <span class="mf">17.343</span><span class="p">,</span> <span class="mf">13.02</span><span class="p">,</span>
                        <span class="mf">15.19</span><span class="p">,</span> <span class="mf">11.902</span><span class="p">,</span> <span class="mf">22.721</span><span class="p">,</span> <span class="mf">22.324</span><span class="p">])</span>
<span class="n">clammy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.389</span><span class="p">,</span>  <span class="mf">0.2</span><span class="p">,</span>    <span class="mf">0.241</span><span class="p">,</span>  <span class="mf">0.463</span><span class="p">,</span>
                   <span class="mf">4.585</span><span class="p">,</span>  <span class="mf">1.097</span><span class="p">,</span>  <span class="mf">1.642</span><span class="p">,</span>  <span class="mf">4.972</span><span class="p">,</span>
                   <span class="mf">7.957</span><span class="p">,</span>  <span class="mf">5.585</span><span class="p">,</span>  <span class="mf">5.527</span><span class="p">,</span>  <span class="mf">6.964</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">psychopathy</span><span class="p">,</span> <span class="n">clammy</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Clammy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Psychopathy&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/why_mse_correlation_3_0.png" src="_images/why_mse_correlation_3_0.png" />
</div>
</div>
<p>To get ourselves into a mathematical mood, we will rename our x-axis values to
<code class="docutils literal notranslate"><span class="pre">x</span></code> and the y-axis values to <code class="docutils literal notranslate"><span class="pre">y</span></code>.  We will store the number of observations in
both as <code class="docutils literal notranslate"><span class="pre">n</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">psychopathy</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">clammy</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are Numpy <em>arrays</em>, but we can also call them <em>vectors</em>.  Vector is
just a technical and mathematical term for a one-dimensional array.</p>
<p>We are on a quest to find why it turned out that the correlation coefficient is
always the best (least squared error) slope for the z-scored versions of these
vectors (1D arrays).  To find out why, we need to express these <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>
vectors in the most general way possible — independent of the numbers we have
here.</p>
<p><span class="math notranslate nohighlight">\(\newcommand{\yvec}{\vec{y}} \newcommand{\xvec}{\vec{x}} \newcommand{\evec}{\vec{\varepsilon}}\)</span></p>
<p>First, in mathematical notation, we will call our <code class="docutils literal notranslate"><span class="pre">x</span></code> array <span class="math notranslate nohighlight">\(\xvec\)</span>, to remind
us that <code class="docutils literal notranslate"><span class="pre">x</span></code> is a vector of numbers, not just a single number.</p>
<p>Next we generalize <span class="math notranslate nohighlight">\(\xvec\)</span> to refer to any set of <span class="math notranslate nohighlight">\(n\)</span> numbers.  So, in our <code class="docutils literal notranslate"><span class="pre">x</span></code>
we have <code class="docutils literal notranslate"><span class="pre">n</span></code> specific numbers, but we generalize <span class="math notranslate nohighlight">\(\xvec\)</span> to mean a series of <span class="math notranslate nohighlight">\(n\)</span>
numbers, where <span class="math notranslate nohighlight">\(n\)</span> can be any number.  We can therefore write <span class="math notranslate nohighlight">\(\xvec\)</span>
mathematically as:</p>
<div class="math notranslate nohighlight">
\[
\xvec = [x_1, x_2, x_3, ..., x_n]
\]</div>
<p>By this we mean that we take <span class="math notranslate nohighlight">\(\xvec\)</span> to be a vector (1D array) of any <span class="math notranslate nohighlight">\(n\)</span>
numbers.</p>
<p>By the same logic, we generalize the array <code class="docutils literal notranslate"><span class="pre">y</span></code> as the vector <span class="math notranslate nohighlight">\(\yvec\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\yvec = [y_1, y_2, y_3, ..., y_n]
\]</div>
</section>
<section id="writing-sums">
<h2>Writing sums<a class="headerlink" href="#writing-sums" title="Permalink to this headline">#</a></h2>
<p>We are next going to do the z-score transform on <span class="math notranslate nohighlight">\(\xvec\)</span> and <span class="math notranslate nohighlight">\(\yvec\)</span>.  As you
remember, this involves subtracting the mean and dividing by the standard
deviation.   We need to express these mathematically.</p>
<p>We will use <a class="reference external" href="https://matthew-brett.github.io/teaching/some_sums.html">sum
notation</a> for this
task.  This uses the symbol <span class="math notranslate nohighlight">\(\Sigma\)</span> to mean adding up the values in a vector.
<span class="math notranslate nohighlight">\(\Sigma\)</span> is capital S in the Greek alphabet.   It is just a shorthand for the
operation we are used to calling <code class="docutils literal notranslate"><span class="pre">sum</span></code> in code.   So:</p>
<div class="math notranslate nohighlight">
\[
\Sigma_{i=1}^{n} x_i = x_1 + x_2 + x_3 ... + x_n
\]</div>
<p>The <span class="math notranslate nohighlight">\(i\)</span> above is the <em>index</em> for the vector, so <span class="math notranslate nohighlight">\(x_i\)</span> means the element from
the vector at position <span class="math notranslate nohighlight">\(i\)</span>.  So, if <span class="math notranslate nohighlight">\(i = 3\)</span> then <span class="math notranslate nohighlight">\(x_i\)</span> is <span class="math notranslate nohighlight">\(x_3\)</span> — the element
at the third position in the vector.</p>
<p>Therefore, in code we, can write <span class="math notranslate nohighlight">\(\Sigma_{i=1}^{n} x_i\)</span> as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>160.448
</pre></div>
</div>
</div>
</div>
<p>The <span class="math notranslate nohighlight">\(i=1\)</span> and <span class="math notranslate nohighlight">\(n\)</span> at the bottom and top of the <span class="math notranslate nohighlight">\(\Sigma\)</span> mean that adding should
start at position 1 (<span class="math notranslate nohighlight">\(x_1\)</span>) and go up to position <span class="math notranslate nohighlight">\(n\)</span> (<span class="math notranslate nohighlight">\(x_n\)</span>).  Of course, this
means all the numbers in the vector.   In this page, we will always sum across
all the numbers in the vector, and we will miss off the <span class="math notranslate nohighlight">\(i=1\)</span> and <span class="math notranslate nohighlight">\(n\)</span> above and
below the <span class="math notranslate nohighlight">\(\Sigma\)</span>, so we will write:</p>
<div class="math notranslate nohighlight">
\[
\Sigma x_i
\]</div>
<p>when we mean:</p>
<div class="math notranslate nohighlight">
\[
\Sigma_{i=1}^{n} x_i
\]</div>
</section>
<section id="mean-and-standard-deviation">
<h2>Mean and standard deviation<a class="headerlink" href="#mean-and-standard-deviation" title="Permalink to this headline">#</a></h2>
<p>Now we have a notation for adding things up in a vector, we can write the
mathematical notation for the mean and standard deviation.</p>
<div class="math notranslate nohighlight">
\[
\newcommand{\xbar}{\bar{x}}
\newcommand{\ybar}{\bar{y}}
\]</div>
<p>We write the mean of a vector <span class="math notranslate nohighlight">\(\xvec\)</span> as <span class="math notranslate nohighlight">\(\xbar\)</span>.  Say <span class="math notranslate nohighlight">\(\xbar\)</span> as “x bar”.  The
definition of the mean is:</p>
<div class="math notranslate nohighlight">
\[
\xbar = \frac{1}{n} \Sigma x_i
\]</div>
<p>Read this as <em>add up all the elements in <span class="math notranslate nohighlight">\(\xvec\)</span> and divide by <span class="math notranslate nohighlight">\(n\)</span></em>.  In code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculation of the mean.</span>
<span class="n">x_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">x_bar</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.370666666666667
</pre></div>
</div>
</div>
</div>
<p>The mean of <span class="math notranslate nohighlight">\(\yvec\)</span> is:</p>
<div class="math notranslate nohighlight">
\[
\ybar = \frac{1}{n} \Sigma y_i
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">y_bar</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.301833333333333
</pre></div>
</div>
</div>
</div>
<p>Next we are going to calculate the <em>standard deviation</em>.  In order to do that,
we start with the <em>deviations</em>. The deviation for each element is the result of
subtracting the mean from the element.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deviations</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_bar</span>
<span class="n">deviations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-1.954667, -8.856667, -1.166667,  1.464333, -4.954667, -6.807667,
        3.972333, -0.350667,  1.819333, -1.468667,  9.350333,  8.953333])
</pre></div>
</div>
</div>
</div>
<p>In mathematical notation, we can write the deviations as:</p>
<div class="math notranslate nohighlight">
\[
[x_1 - \xbar, x_2 - \xbar, x_3 - \xbar, ..., x_n - \xbar]
\]</div>
<p>We have the deviations but we want something called the <em>standard</em> deviation, a
measure of how far the typical (standard) value deviates from the mean.</p>
<p>To start, we turn all the deviations to positive values by squaring them.  These are the <em>squared deviations</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">squared_deviations</span> <span class="o">=</span> <span class="n">deviations</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">squared_deviations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 3.820722, 78.440544,  1.361111,  2.144272, 24.548722, 46.344325,
       15.779432,  0.122967,  3.309974,  2.156982, 87.428733, 80.162178])
</pre></div>
</div>
</div>
</div>
<div class="math notranslate nohighlight">
\[
[(x_1 - \xbar)^2, (x_2 - \xbar)^2, (x_3 - \xbar)^2, ..., (x_n - \xbar)^2]
\]</div>
<p>We can now get an average <em>squared deviation</em>.  We can call this the <em>mean
squared deviation</em>, but we often call this value — the <em>variance</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variance is the mean squared deviation.</span>
<span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">squared_deviations</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">variance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>28.80166355555556
</pre></div>
</div>
</div>
</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{n} \Sigma (x_i - \xbar)^2
\]</div>
<p>The <em>standard deviation</em> is the square root of the mean squared deviation — the
square root of the variance. We often write the standard deviation as <span class="math notranslate nohighlight">\(\sigma\)</span>.
Read this as “sigma”.  <span class="math notranslate nohighlight">\(\sigma\)</span> is a small “s” in the Greek alphabet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard deviation</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span>
<span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.366718136399149
</pre></div>
</div>
</div>
</div>
<p>These are simple calculations, but Numpy also has a short-cut to do them, called <code class="docutils literal notranslate"><span class="pre">np.std</span></code> (NumPy STandard Deviation):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Numpy calculation of the standard deviation.</span>
<span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.366718136399149
</pre></div>
</div>
</div>
</div>
<p>We often find ourselves writing equations with the standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span>
and the variance (mean squared deviation).  Because the variance is the squared
standard deviation, we usually write the variance as <span class="math notranslate nohighlight">\(\sigma^2\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\sigma^2 = \frac{1}{n} \Sigma (x_i - \xbar)^2
\]</div>
<p>And:</p>
<div class="math notranslate nohighlight">
\[
\sigma = \sqrt{\sigma^2}
\]</div>
<p>We can be more specific about which vector we are referring to, by adding the
vector name as a subscript.  For example, if we mean the standard deviation for
<span class="math notranslate nohighlight">\(\xvec\)</span>, we could write this as <span class="math notranslate nohighlight">\(\sigma_x\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\sigma_x^2 = \frac{1}{n} \Sigma (x_i - \xbar)^2 \\
\sigma_x = \sqrt{\sigma_x^2}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">sigma_x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.366718136399149
</pre></div>
</div>
</div>
</div>
<p>Similarly for <span class="math notranslate nohighlight">\(\yvec\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\sigma_y^2 = \frac{1}{n} \Sigma (y_i - \ybar)^2 \\
\sigma_y = \sqrt{\sigma_y^2}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">sigma_y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.78136974149229
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-z-score-transformation">
<h2>The z-score transformation<a class="headerlink" href="#the-z-score-transformation" title="Permalink to this headline">#</a></h2>
<p>The z-score transformation is to subtract the mean and divide by the standard
deviation.  Put another way, the z-scores are the <em>deviations</em> divided by the
<em>standard deviation</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_bar</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma_x</span>
<span class="n">z_x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-0.36422 , -1.650295, -0.217389,  0.272855, -0.923221, -1.268497,
        0.740179, -0.065341,  0.339003, -0.273662,  1.742281,  1.668307])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_bar</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma_y</span>
<span class="n">z_y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-1.047266, -1.115218, -1.100477, -1.02066 ,  0.461343, -0.792715,
       -0.596768,  0.600484,  1.673696,  0.820879,  0.800025,  1.316677])
</pre></div>
</div>
</div>
</div>
<div class="math notranslate nohighlight">
\[
\newcommand{\zxvec}{\vec{z_x}}
\newcommand{\zyvec}{\vec{z_y}}
\]</div>
<p>Write the z-scores corresponding to <span class="math notranslate nohighlight">\(\xvec\)</span> as <span class="math notranslate nohighlight">\(\zxvec\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\zxvec = [ (x_1 - \xbar) / \sigma_x, (x_2 - \xbar) / \sigma_x, ...
           (x_n - \xbar) / \sigma_x ]
\]</div>
<p>That is the same as saying:</p>
<div class="math notranslate nohighlight">
\[
z_{x_i} = (x_i - \xbar) / \sigma_x
\]</div>
</section>
<section id="correlation">
<h2>Correlation<a class="headerlink" href="#correlation" title="Permalink to this headline">#</a></h2>
<p>You may remember that the correlation calculation is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z_x</span> <span class="o">*</span> <span class="n">z_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
<span class="n">r</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5178777312914015
</pre></div>
</div>
</div>
</div>
<p>In mathematical notation:</p>
<div class="math notranslate nohighlight">
\[
r = \frac{1}{n} \Sigma z_{x_i} z_{y_i}
\]</div>
</section>
<section id="sum-of-squared-error-for-z-scored-lines">
<h2>Sum of squared error for z-scored lines<a class="headerlink" href="#sum-of-squared-error-for-z-scored-lines" title="Permalink to this headline">#</a></h2>
<p>We remind ourselves of the sum of squared error (SSE) for a given slope <code class="docutils literal notranslate"><span class="pre">b</span></code> and
intercept <code class="docutils literal notranslate"><span class="pre">c</span></code>.</p>
<p>Here is a function to calculate the sum of squared error for a given x and y
vector, slope and intercept:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_sse</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">y_vals</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sum of squared error for slope `b`, intercept `c`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="n">x_vals</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">y_vals</span> <span class="o">-</span> <span class="n">predicted</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">errors</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us start by calculating the SSE values for 1000 intercepts between -1 and
1, and slope of 0.6, using the z-scored x and y values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_intercepts</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">intercepts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_intercepts</span><span class="p">)</span>
<span class="n">sse_inters_b0p6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_intercepts</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_intercepts</span><span class="p">):</span>
    <span class="n">sse_inters_b0p6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_sse</span><span class="p">(</span><span class="n">z_x</span><span class="p">,</span> <span class="n">z_y</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">intercepts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">intercepts</span><span class="p">,</span> <span class="n">sse_inters_b0p6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;intercept&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SSE for intercept, b=0.6&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/why_mse_correlation_40_0.png" src="_images/why_mse_correlation_40_0.png" />
</div>
</div>
<p>As <a class="reference internal" href="on_regression.html"><span class="doc std std-doc">before</span></a>, it looks as though <span class="math notranslate nohighlight">\(c=0\)</span> is the intercept that
minimizes the SSE, for a slope of 0.6.</p>
<p>Now let us try many slopes, for an intercept of 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_slopes</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_slopes</span><span class="p">)</span>
<span class="n">sse_slopes_c0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_slopes</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_slopes</span><span class="p">):</span>
    <span class="n">sse_slopes_c0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_sse</span><span class="p">(</span><span class="n">z_x</span><span class="p">,</span> <span class="n">z_y</span><span class="p">,</span> <span class="n">slopes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slopes</span><span class="p">,</span> <span class="n">sse_slopes_c0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;slope&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SSE for slope, c=0&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/why_mse_correlation_42_0.png" src="_images/why_mse_correlation_42_0.png" />
</div>
</div>
<p>This suggests that the slope minimizing the SSE is around 0.52, at least, for
an intercept of 0.  It turns out that the correlation value <span class="math notranslate nohighlight">\(r\)</span> above is always
the best SSE slope for the z-score line.  Our remaining task is to prove this
with the mathematical notation we have built up.</p>
</section>
<section id="some-interesting-characteristics-of-z-scores">
<h2>Some interesting characteristics of z-scores<a class="headerlink" href="#some-interesting-characteristics-of-z-scores" title="Permalink to this headline">#</a></h2>
<p>Z-score vectors have a couple of interesting and important mathematical properties.</p>
<p>They have a sum of zero (within the calculation precision of the computer):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.661338147750939e-16
</pre></div>
</div>
</div>
</div>
<p>Therefore they also have a mean of (near as dammit) zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.551115123125783e-17
</pre></div>
</div>
</div>
</div>
<p>The z-scores have a standard deviation of (near-as-dammit) 1, and therefore, a variance of 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">z_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9999999999999999
</pre></div>
</div>
</div>
</div>
<p>This is true for any vector <span class="math notranslate nohighlight">\(\xvec\)</span> (or <span class="math notranslate nohighlight">\(\yvec\)</span>).  Why?</p>
<p>To answer that question, we need the results from the <a class="reference external" href="https://matthew-brett.github.io/teaching/some_sums.html">algebra of
sums</a>.  If you read that short page, you fill find that these general results hold:</p>
<section id="addition-inside-sum">
<h3>Addition inside sum<a class="headerlink" href="#addition-inside-sum" title="Permalink to this headline">#</a></h3>
<div class="math notranslate nohighlight">
\[\begin{split}
\Sigma (x_i + y_i) = \\
(x_1 + y_1) + (x_2 + y_2) + \cdots (x_n + y_n) = \\
(x_1 + x_2 + \cdots x_n) + (y_1 + y_2 + \cdots y_n) = \\
\Sigma x_i + \Sigma y_i
\end{split}\]</div>
</section>
<section id="multiplication-by-constant-inside-sum">
<h3>Multiplication by constant inside sum<a class="headerlink" href="#multiplication-by-constant-inside-sum" title="Permalink to this headline">#</a></h3>
<div class="math notranslate nohighlight">
\[\begin{split}
\Sigma c x_i = \\
c x_1 + c x_2 + \cdots c x_n = \\
c (x_1 + x_2 + \cdots x_n) = \\
c \Sigma x_i
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(c\)</span> is some constant (number).</p>
</section>
<section id="sum-of-constant-value">
<h3>Sum of constant value<a class="headerlink" href="#sum-of-constant-value" title="Permalink to this headline">#</a></h3>
<div class="math notranslate nohighlight">
\[
\Sigma_{i=1}^n c = c + c + ... + c = n c
\]</div>
</section>
</section>
<section id="characteristics-of-z-scores">
<h2>Characteristics of z-scores<a class="headerlink" href="#characteristics-of-z-scores" title="Permalink to this headline">#</a></h2>
<p>With the results above, we can prove z-scores have a sum of 0:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Sigma z_x = \Sigma ((x_i - \xbar) / \sigma_x) \\
= \frac{1}{\sigma_x} \Sigma (x_i - \xbar) \\
= \frac{1}{\sigma_x} (\Sigma x_i - \Sigma \xbar) \\
= \frac{1}{\sigma_x} (n \xbar - n \xbar) \\
= 0
\end{split}\]</div>
<p>Therefore, it is always true that the sum and mean of a z-score vector are 0.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Sigma z_x = 0 \\
\bar{z_x} = 0
\end{split}\]</div>
<p>Next we show z-scores have a variance, and therefore, standard deviation, of 1.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\sigma^2_{z_x} = \frac{1}{n} \Sigma (z_{x_i} - \bar{z_x})^2 \\
= \frac{1}{n} \Sigma (z_{x_i})^2 \\
= \frac{1}{n} \Sigma ((x_i - \xbar) / \sigma_x)^2 \\
= \frac{1}{\sigma_x^2} \frac{1}{n} \Sigma (x_i - \xbar)^2 \\
= \frac{1}{\sigma_x^2} \sigma^2_x \\
= 1
\end{split}\]</div>
<p>Thus we have learned that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\sigma^2_{z_x} = 1 \\
\sigma_{z_x} = 1
\end{split}\]</div>
<p>Because <span class="math notranslate nohighlight">\(\sigma^2_{z_x} = \frac{1}{n} \Sigma (z_{x_i})^2 = 1\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\Sigma (z_{x_i})^2 = n \sigma^2_{z_x} = n
\]</div>
</section>
<section id="the-least-squares-line-for-z-scores">
<h2>The least-squares line for z-scores<a class="headerlink" href="#the-least-squares-line-for-z-scores" title="Permalink to this headline">#</a></h2>
<p>Let us say we have a data vector <span class="math notranslate nohighlight">\(\yvec\)</span>.  We have somehow calculated an estimated (fitted)
value <span class="math notranslate nohighlight">\(\hat{y}_i\)</span> for every corresponding value <span class="math notranslate nohighlight">\(y_i\)</span> in <span class="math notranslate nohighlight">\(\yvec\)</span>.  Then the errors at
each value <span class="math notranslate nohighlight">\(i\)</span> are given by:</p>
<div class="math notranslate nohighlight">
\[
e_i = y_i - \hat{y}_i
\]</div>
<p>The sum of squared errors are:</p>
<div class="math notranslate nohighlight">
\[
SSE = \Sigma (y_i - \hat{y}_i)^2
\]</div>
<p>Remembering that <span class="math notranslate nohighlight">\((a + b)^2 = (a + b)(a + b) = a^2 + 2ab + b^2\)</span> we get:</p>
<div class="math notranslate nohighlight">
\[
SSE = \Sigma (y_i^2 - 2y_i \hat{y}_i + \hat{y}_i^2)
\]</div>
<p>Simplifying with rules of sums above:</p>
<div class="math notranslate nohighlight">
\[
SSE = \Sigma y_i^2 - 2 \Sigma y_i \hat{y}_i + \Sigma \hat{y}_i^2
\]</div>
<p>Now we introduce our fitted value <span class="math notranslate nohighlight">\(\hat{y}_i\)</span>, which we get from our straight line
with slope <span class="math notranslate nohighlight">\(b\)</span> and intercept <span class="math notranslate nohighlight">\(c\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\hat{y}_i = b x_i + c
\]</div>
<p>Substituting, then simplifying:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
SSE = \Sigma y_i^2 - 2 \Sigma y_i (b x_i + c) + \Sigma (b x_i + c)^2 \\
= \Sigma y_i^2 - 2 \Sigma (y_i b x_i + y_i c)  +
\Sigma (b^2 x_i^2 + 2 b x_i c + c^2) \\
= \Sigma y_i^2 - 2 b \Sigma y_i x_i - 2 c \Sigma y_i +
b^2 \Sigma x_i^2 + 2 b c \Sigma x_i + n c^2
\end{split}\]</div>
<p>Now, let us assume our <span class="math notranslate nohighlight">\(y_i\)</span> and <span class="math notranslate nohighlight">\(x_i\)</span> values are z-scores.  To indicate this,
we will use <span class="math notranslate nohighlight">\(z_{y_i}\)</span> and <span class="math notranslate nohighlight">\(z_{x_i}\)</span> instead of <span class="math notranslate nohighlight">\(y_i\)</span> and <span class="math notranslate nohighlight">\(x_i\)</span>.  As you
remember from the results above:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Sigma z_{y_i}^2 = n \\
\Sigma z_{y_i} = 0 \\
\Sigma z_{x_i}^2 = n \\
\Sigma z_{x_i} = 0
\end{split}\]</div>
<p>In that case, the equation above simplifies to:</p>
<div class="math notranslate nohighlight">
\[
SSE_z = n - 2 b \Sigma z_{y_i} z_{x_i} + b^2 n + n c^2
\]</div>
</section>
<section id="reality-check">
<h2>Reality check<a class="headerlink" href="#reality-check" title="Permalink to this headline">#</a></h2>
<p>Let us pause at this point for a reality check.  If we have done our derivation
correctly, then the formula above should give the same answer as the <code class="docutils literal notranslate"><span class="pre">calc_sse</span></code>
function above.  Let’s check.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_sse_simplified</span><span class="p">(</span><span class="n">z_x</span><span class="p">,</span> <span class="n">z_y</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Implement simplified z-score SSE equation above</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_x</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z_x</span> <span class="o">*</span> <span class="n">z_y</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">c</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Does this give the same values as we saw before, for our example intercepts and
slope of 0.6?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sse_simplified_b0p6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_intercepts</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_intercepts</span><span class="p">):</span>
    <span class="n">sse_simplified_b0p6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_sse_simplified</span><span class="p">(</span><span class="n">z_x</span><span class="p">,</span> <span class="n">z_y</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">intercepts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1"># Does it give the same results as we got from the original function?</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">sse_simplified_b0p6</span><span class="p">,</span> <span class="n">sse_inters_b0p6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>How about the example slopes and intercept of 0?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sse_simplified_c0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_slopes</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_slopes</span><span class="p">):</span>
    <span class="n">sse_simplified_c0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_sse_simplified</span><span class="p">(</span><span class="n">z_x</span><span class="p">,</span> <span class="n">z_y</span><span class="p">,</span> <span class="n">slopes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1"># Does it give the same results as we got from the original function?</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">sse_simplified_c0</span><span class="p">,</span> <span class="n">sse_slopes_c0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>No errors — we appear to be on the right mathematical track.</p>
</section>
<section id="finding-the-trough-in-the-sse-function">
<h2>Finding the trough in the SSE function<a class="headerlink" href="#finding-the-trough-in-the-sse-function" title="Permalink to this headline">#</a></h2>
<p>We want to find the slope, intercept pair <span class="math notranslate nohighlight">\(b, c\)</span> that gives us the lowest SSE
value.</p>
<p>To do this, we remind ourselves that the SSE equation above is a <em>function</em>
that varies with respect to <span class="math notranslate nohighlight">\(b\)</span> and with respect to <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>Here we plot this function, again, for a variety of values of <span class="math notranslate nohighlight">\(b\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slopes</span><span class="p">,</span> <span class="n">sse_simplified_c0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SSE for given b, c=0&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/why_mse_correlation_69_0.png" src="_images/why_mse_correlation_69_0.png" />
</div>
</div>
<p>We would like to find the slope <span class="math notranslate nohighlight">\(b\)</span> value corresponding to the minimum of the
SSE function.  The standard mathematical way to do that is to first make a new
function that gives the <em>gradient</em> of the SSE line, at every value for - in our
case - <span class="math notranslate nohighlight">\(b\)</span>. This new gradient function is called the <em>derivative</em> of the SSE
function.  Then we find the value of <span class="math notranslate nohighlight">\(b\)</span> for which the gradient (derivative
function) is 0.  You can see from the graph that the gradient will go to 0 when
the function has got to the minimum point, because the gradient is turning from
negative to positive.  So, when we have found the gradient=0 point, and
confirmed it is at the bottom of a trough, as we see in the graph, then we have
found the value of <span class="math notranslate nohighlight">\(b\)</span> that minimizes the original SSE function.</p>
<p>We can see the shape of our function curve, and it looks like it is a simple
parabola, with one minimum.  When we take the derivative of function, which
gives us the gradient, we expect to see a single x value where the gradient is
0, and we can see that is a minimum point.  But, to be sure about this, in the
general case, we will first want to check that there is in fact only one x
value for which the derivative is 0.  And next, we will want to check whether
this point is a minimum point or a maximum point.  You can probably imagine
that a peak (maximum point) is also going to have a derivative of 0, as the
slope goes from positive to negative. In order to check whether a 0 in the
derivative is a maximum or a minimum, we take the gradient of the gradient (the
derivative of the derivative).  This is the <em>second derivative</em>.  Think of it
as the rate of change of the gradient.  If we are at a minimum point, then this
rate of change of the gradient is positive, as the gradient goes from negative
to positive.  If we are at a maximum point, this rate of change of the gradient
will be negative, as the gradient goes from positive to negative.</p>
<p>Taking the derivative is also called <em>differentiating</em> the function.</p>
<p>You need to know some rules for taking the derivative, but these rules are not
hard to derive, once you are used to the idea of taking the derivative.  The
key ones rules here are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Differentiation_rules#Constant_Term_Rule">Constant term
rule</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Linearity_of_differentiation">Linearity</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Power_rule">Power rule</a></p></li>
</ul>
<p>You need to know too, that when differentiating with respect to some variable,
say <span class="math notranslate nohighlight">\(x\)</span>, you can ignore (set to 0) all terms that do not vary with <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>Let us first take the derivative of the <span class="math notranslate nohighlight">\(SSE_z\)</span> function above, with respect to
<span class="math notranslate nohighlight">\(c\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial SSE_z}{\partial c} = 2 n c
\]</div>
<p>This is zero only when <span class="math notranslate nohighlight">\(c = 0\)</span>.   Differentiate again to give <span class="math notranslate nohighlight">\(2n\)</span>; the second
derivative is always positive, so the zero point of the first derivative is a
trough (minimum) rather than a peak (maximum).</p>
<p>We have discovered that, regardless of the slope <span class="math notranslate nohighlight">\(b\)</span>, the intercept <span class="math notranslate nohighlight">\(c\)</span> that
minimizes the sum (and mean) squared error is 0.</p>
<p>Now we have established the always-gives-SSE-minimum value for <span class="math notranslate nohighlight">\(c\)</span>, substitute
back into the equation above:</p>
<div class="math notranslate nohighlight">
\[
SSE_z = n - 2 b \Sigma z_{y_i} z_{x_i} + b^2 n
\]</div>
<p>Differentiate with respect to <span class="math notranslate nohighlight">\(b\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial SSE_z}{\partial b} = - 2 \Sigma z_{y_i} z_{x_i} + 2 b n
\]</div>
<p>This is zero when:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{n} \Sigma z_{y_i} z_{x_i} = b
\]</div>
<p>Differentiate again to get:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial ^2SSE_z}{\partial b^2} = 2 n
\]</div>
<p>The second derivative is always positive, so the zero for the first derivative
corresponds to a trough (minimum) rather than a peak (maximum).</p>
<p>We have discovered that the slope of the line that minimizes <span class="math notranslate nohighlight">\(SSE_z\)</span> is
<span class="math notranslate nohighlight">\(\frac{1}{n} \Sigma z_{x_i} z_{y_i}\)</span> — AKA the correlation.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "nipraxis/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The nipraxis team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>