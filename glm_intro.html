
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Introduction to the general linear model &#8212; Practice and theory of brain imaging</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="A worked example of the general linear model" href="mean_test_example.html" />
    <link rel="prev" title="Regression for a single voxel" href="regress_one_voxel.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/reggie.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Practice and theory of brain imaging</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Practice and theory of brain imaging
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The neuroimaging problem
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="the_problem.html">
   The problem and the plan
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The tools
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="to_code.html">
   Ode to code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="surviving_computers.html">
   Surviving the computer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="the_software.html">
   Our tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="using_jupyter.html">
   Using Jupyter notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="more_on_jupyter.html">
   More on the Jupyter notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="brisk_python.html">
   Brisk introduction to Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   Installing on your computer
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Images and code and images
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="pathlib.html">
   Using the
   <code class="docutils literal notranslate">
    <span class="pre">
     pathlib
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="what_is_an_image.html">
   What is an image?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_intro.html">
   Introduction to Numpy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boolean_arrays.html">
   Boolean arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reshape_and_2d.html">
   Two-dimensions, reshaping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arrays_and_images.html">
   Arrays as images, images as arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arrays_3d.html">
   Three-dimensional arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="images_3d.html">
   Three-dimensional images, NIfTI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reshape_and_3d.html">
   Reshaping and three-dimensional arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boolean_indexing.html">
   Indexing with Boolean arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="boolean_indexing_nd.html">
   Boolean indexing with more than one dimension
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_to_4d.html">
   Working with four dimensional images, masks and functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reshape_and_4d.html">
   Reshaping, 4D to 2D
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="voxels_by_time.html">
   Voxels and time
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Working reproducibly
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="on_modules.html">
   Modules and scripts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sys_path.html">
   Where does Python look for modules?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assert.html">
   Using
   <code class="docutils literal notranslate">
    <span class="pre">
     assert
    </span>
   </code>
   for testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coding_style.html">
   Python coding style
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="docstrings.html">
   Docstrings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="module_directories.html">
   Module directories
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="on_testing.html">
   On testing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Detecting activation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="voxel_time_courses.html">
   Correlating with voxel time courses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="on_convolution.html">
   Convolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="convolution_background.html">
   Convolving with the hemodyamic response function
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="on_regression.html">
   Introducing regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regress_one_voxel.html">
   Regression for a single voxel
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Introduction to the general linear model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mean_test_example.html">
   A worked example of the general linear model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model_one_voxel.html">
   Modeling a single voxel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_multiply.html">
   Estimation for many voxels at the same time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hypothesis_tests.html">
   Hypothesis testing with the general linear model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="test_one_voxel.html">
   Testing a single voxel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="non_tr_onsets.html">
   Using onsets that do not start on a TR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="whole_image_statistics.html">
   Whole-brain t tests and p values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bonferroni_correction.html">
   Notes on the Bonferroni threshold
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Spatial processing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="slice_timing.html">
   Slice timing correction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optimizing_space.html">
   Calculating transformations between images
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="diagonal_zooms.html">
   Encoding zooms (scaling) with a diagonal matrix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nibabel_affines.html">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     nibabel.affines
    </span>
   </code>
   module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nibabel_apply_affine.html">
   Applying coordinate transforms with
   <code class="docutils literal notranslate">
    <span class="pre">
     nibabel.affines.apply_affine
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="map_coordinates.html">
   General resampling between images with
   <code class="docutils literal notranslate">
    <span class="pre">
     scipy.ndimage.map_coordinates
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="image_header_and_affine.html">
   The image header and affine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="images_and_affines.html">
   Images and affines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rotation_2d_3d.html">
   Rotations and rotation matrices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="resampling_with_ndimage.html">
   Resampling with
   <code class="docutils literal notranslate">
    <span class="pre">
     scipy.ndimage
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dipy_registration.html">
   Registration with dipy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="anterior_cingulate.html">
   Anterior cingulate
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notes on arrays and plots
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="methods_vs_functions.html">
   Methods vs functions in NumPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="allclose.html">
   Testing for near equality with “allclose”
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arange.html">
   NumPy arange
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_logical.html">
   Logical operations on Boolean arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dot_outer.html">
   Vector and matrix dot products, “np.outer”
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newaxis.html">
   Adding length 1 dimensions with newaxis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="array_reductions.html">
   Array reduction operations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numpy_random.html">
   Numpy random number generators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="subtract_means.html">
   Subtracting the mean from columns or rows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot_lines.html">
   Plotting lines in matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="subplots.html">
   Subplots and axes in matplotlib
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/nipraxis/textbook/main?urlpath=tree/glm_intro.Rmd"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://hub.nipraxis.org/hub/user-redirect/git-pull?repo=https%3A//github.com/nipraxis/textbook&urlpath=tree/textbook/glm_intro.Rmd&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/nipraxis/textbook/blob/main/glm_intro.Rmd"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fnipraxis%2Ftextbook%2Fblob%2Fmain%2Fglm_intro.Rmd"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Deepnote"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_deepnote.svg">
  </span>
<span class="headerbtn__text-container">Deepnote</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/nipraxis/textbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/nipraxis/textbook/issues/new?title=Issue%20on%20page%20%2Fglm_intro.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/glm_intro.Rmd"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.Rmd</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-regression">
   Simple regression
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-regression-in-matrix-form">
   Simple regression in matrix form
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multiple-regression">
   Multiple regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#population-sample-estimate">
     Population, sample, estimate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-the-model-with-matrix-algebra">
   Solving the model with matrix algebra
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contrasts">
   Contrasts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dummy-coding-and-the-general-linear-model">
   Dummy coding and the general linear model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ancova-in-the-general-linear-model">
   ANCOVA in the General Linear Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#displaying-the-design-matrix-as-an-image">
   Displaying the design matrix as an image
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Introduction to the general linear model</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-regression">
   Simple regression
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-regression-in-matrix-form">
   Simple regression in matrix form
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multiple-regression">
   Multiple regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#population-sample-estimate">
     Population, sample, estimate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-the-model-with-matrix-algebra">
   Solving the model with matrix algebra
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contrasts">
   Contrasts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dummy-coding-and-the-general-linear-model">
   Dummy coding and the general linear model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ancova-in-the-general-linear-model">
   ANCOVA in the General Linear Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#displaying-the-design-matrix-as-an-image">
   Displaying the design matrix as an image
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="introduction-to-the-general-linear-model">
<h1>Introduction to the general linear model<a class="headerlink" href="#introduction-to-the-general-linear-model" title="Permalink to this headline">#</a></h1>
<p>For more detail on the General Linear Model, see <a class="reference external" href="http://matthew.dynevor.org/_downloads/does_glm_love.pdf">The general linear model and
fMRI: Does love last
forever?</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import numerical and plotting libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="k">as</span> <span class="nn">npl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># Only show 6 decimals when printing</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This page starts with the model for simple regression, that you have already see in the <a class="reference internal" href="on_regression.html"><span class="doc std std-doc">regression page</span></a>.
We then show how the simple regression gets expressed in a <em>design matrix</em>.
Once we have that, it’s easy to extend simple regression to multiple
regression. By adding some specially formed regressors, we can also express
group membership, and therefore do ANalysis Of VAriance (ANOVA). This last
step is where multiple regression becomes the General Linear Model (GLM).</p>
<section id="simple-regression">
<h2>Simple regression<a class="headerlink" href="#simple-regression" title="Permalink to this headline">#</a></h2>
<p>You have already seen this problem in the <a class="reference internal" href="on_regression.html"><span class="doc std std-doc">regression
page</span></a>.</p>
<p>Image we have measured scores for a “psychopathy” personality trait in 12
students. We also have some other information about these students. For
example, we measured how much sweat each student had on their palms, and we
call this a “clammy” score.  We will look for a straight-line (linear)
relationship between the “clammy” score (our predictor or regressor or
covariate or independent variable) and the “psychopathy” score (our dependent
variable).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The values we are trying to predict.</span>
<span class="n">psychopathy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">11.416</span><span class="p">,</span>   <span class="mf">4.514</span><span class="p">,</span>  <span class="mf">12.204</span><span class="p">,</span>  <span class="mf">14.835</span><span class="p">,</span>
      <span class="mf">8.416</span><span class="p">,</span>   <span class="mf">6.563</span><span class="p">,</span>  <span class="mf">17.343</span><span class="p">,</span>  <span class="mf">13.02</span><span class="p">,</span>
     <span class="mf">15.19</span> <span class="p">,</span>  <span class="mf">11.902</span><span class="p">,</span>  <span class="mf">22.721</span><span class="p">,</span>  <span class="mf">22.324</span><span class="p">])</span>

<span class="c1"># The values we will predict with.</span>
<span class="n">clammy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">0.389</span><span class="p">,</span>  <span class="mf">0.2</span>  <span class="p">,</span>  <span class="mf">0.241</span><span class="p">,</span>  <span class="mf">0.463</span><span class="p">,</span>
     <span class="mf">4.585</span><span class="p">,</span>  <span class="mf">1.097</span><span class="p">,</span>  <span class="mf">1.642</span><span class="p">,</span>  <span class="mf">4.972</span><span class="p">,</span>
     <span class="mf">7.957</span><span class="p">,</span>  <span class="mf">5.585</span><span class="p">,</span>  <span class="mf">5.527</span><span class="p">,</span>  <span class="mf">6.964</span><span class="p">])</span>

<span class="c1"># The number of values</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clammy</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clammy</span><span class="p">,</span> <span class="n">psychopathy</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Clamminess of handshake&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Psychopathy score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Psychopathy score&#39;)
</pre></div>
</div>
<img alt="_images/glm_intro_5_1.png" src="_images/glm_intro_5_1.png" />
</div>
</div>
<p>You have already seen a preliminary guess we made at a straight line that links the <code class="docutils literal notranslate"><span class="pre">clammy</span></code> scores to the <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code> scores.  Our guess was:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">guessed_slope</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">guessed_intercept</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<p>We use this line to <em>predict</em> the <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code> scores from the <code class="docutils literal notranslate"><span class="pre">clammy</span></code> scores.</p>
<p>What does our straight line relationship mean?</p>
<p>We are saying that the values of <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code> can be partly predicted by
a straight line of formula <code class="docutils literal notranslate"><span class="pre">0.9</span> <span class="pre">*</span> <span class="pre">clammy</span> <span class="pre">+</span> <span class="pre">10</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predicted_psychopathy</span> <span class="o">=</span> <span class="n">guessed_slope</span> <span class="o">*</span> <span class="n">clammy</span> <span class="o">+</span> <span class="n">guessed_intercept</span>
<span class="n">predicted_psychopathy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([10.3501, 10.18  , 10.2169, 10.4167, 14.1265, 10.9873, 11.4778,
       14.4748, 17.1613, 15.0265, 14.9743, 16.2676])
</pre></div>
</div>
</div>
</div>
<p>Here are the data and our predictions from the guessed line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the data and the predictions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clammy</span><span class="p">,</span> <span class="n">psychopathy</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clammy</span><span class="p">,</span> <span class="n">predicted_psychopathy</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predictions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Clamminess of handshake&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Psychopathy score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Clammy vs psychopathy with guessed line&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f83a457ceb0&gt;
</pre></div>
</div>
<img alt="_images/glm_intro_11_1.png" src="_images/glm_intro_11_1.png" />
</div>
</div>
<p>Our next step is to write out this model more formally in mathematical
symbols.</p>
<p><span class="math notranslate nohighlight">\(\newcommand{\yvec}{\vec{y}} \newcommand{\xvec}{\vec{x}} \newcommand{\evec}{\vec{\varepsilon}}\)</span></p>
<p>To make this more general, let’s call our <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code> data
<span class="math notranslate nohighlight">\(\yvec\)</span> - a <em>vector</em> with 12 values, one for each student.   A <em>vector</em> is just a sequence of values.</p>
<p><span class="math notranslate nohighlight">\(y_1\)</span> is the value for the first student (= 11.416) and <span class="math notranslate nohighlight">\(y_i\)</span> is the value for
student <span class="math notranslate nohighlight">\(i\)</span> where <span class="math notranslate nohighlight">\(i \in 1 .. 12\)</span>:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell - it is to give a better display to the mathematics.</span>
<span class="c1"># Import Symbolic mathematics routines.</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">IndexedBase</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">init_printing</span>
<span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">MatAdd</span><span class="p">,</span> <span class="n">MatMul</span><span class="p">,</span> <span class="n">MatrixSymbol</span>

<span class="c1"># Make equations print in definition order.</span>
<span class="n">init_printing</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

<span class="n">sy_y</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\vec</span><span class="si">{y}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">sy_y_ind</span> <span class="o">=</span> <span class="n">IndexedBase</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">vector_indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sy_y_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">sy_y_ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vector_indices</span><span class="p">])</span>

<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">psychopathy</span><span class="p">)),</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \vec{y} = \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = \left[\begin{matrix}11.416\\4.514\\12.204\\14.835\\8.416\\6.563\\17.343\\13.02\\15.19\\11.902\\22.721\\22.324\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">clammy</span></code> score is a <em>predictor</em>. Lets call the clammy scores <span class="math notranslate nohighlight">\(\xvec\)</span>.
<span class="math notranslate nohighlight">\(\xvec\)</span> is another vector with 12 values. <span class="math notranslate nohighlight">\(x_1\)</span> is the value for the first
student (= 0.389) and <span class="math notranslate nohighlight">\(x_i\)</span> is the value for student <span class="math notranslate nohighlight">\(i\)</span> where <span class="math notranslate nohighlight">\(i \in 1 ..
12\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell - it is to give a better display to the mathematics.</span>
<span class="n">sy_x</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\vec</span><span class="si">{x}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">sy_x_ind</span> <span class="o">=</span> <span class="n">IndexedBase</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">sy_x_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">sy_x_ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vector_indices</span><span class="p">])</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_x</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">sy_x_val</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">clammy</span><span class="p">)),</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \vec{x} = \left[\begin{matrix}{x}_{1}\\{x}_{2}\\{x}_{3}\\{x}_{4}\\{x}_{5}\\{x}_{6}\\{x}_{7}\\{x}_{8}\\{x}_{9}\\{x}_{10}\\{x}_{11}\\{x}_{12}\end{matrix}\right] = \left[\begin{matrix}0.389\\0.2\\0.241\\0.463\\4.585\\1.097\\1.642\\4.972\\7.957\\5.585\\5.527\\6.964\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>Our straight line model says:</p>
<p><span class="math notranslate nohighlight">\(y_i \approx bx_i + c\)</span></p>
<p><span class="math notranslate nohighlight">\(\approx\)</span> above means <em>approximately equal to</em>, <span class="math notranslate nohighlight">\(b\)</span> is the slope and <span class="math notranslate nohighlight">\(c\)</span> is
the intercept. For the guessed line above:</p>
<p><span class="math notranslate nohighlight">\(y_i \approx 0.9 x_i + 10\)</span></p>
<p>With the <span class="math notranslate nohighlight">\(\approx\)</span>, we are accepting that we will not succeed in explaining
our psychopathy values exactly. We can rephrase this by saying that each
observation is equal to the predicted value (from the formula above) plus some
error for each observation:</p>
<p><span class="math notranslate nohighlight">\(y_i = bx_i + c + e_i\)</span></p>
</section>
<section id="simple-regression-in-matrix-form">
<h2>Simple regression in matrix form<a class="headerlink" href="#simple-regression-in-matrix-form" title="Permalink to this headline">#</a></h2>
<p>It turns out it will be useful to rephrase the simple regression model
in <em>matrix form</em>. Let’s make the data and predictor and errors into
vectors.</p>
<p>We already the <span class="math notranslate nohighlight">\(y\)</span> values in our <span class="math notranslate nohighlight">\(\yvec\)</span> vector above, and the <span class="math notranslate nohighlight">\(x\)</span> values in the <span class="math notranslate nohighlight">\(\xvec\)</span> vector.</p>
<p><span class="math notranslate nohighlight">\(\evec\)</span> is the vector of as-yet-unknown errors <span class="math notranslate nohighlight">\(e_1, e_2,  ... e_{12}\)</span>.  The
values of the errors depend on the predicted values, and therefore, on our
slope <span class="math notranslate nohighlight">\(b\)</span> and intercept <span class="math notranslate nohighlight">\(c\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">sy_e</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\vec{\varepsilon}&#39;</span><span class="p">)</span>
<span class="n">sy_e_ind</span> <span class="o">=</span> <span class="n">IndexedBase</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span>
<span class="n">sy_e_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">sy_e_ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vector_indices</span><span class="p">])</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_e</span><span class="p">,</span> <span class="n">sy_e_val</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \vec{\varepsilon} = \left[\begin{matrix}{e}_{1}\\{e}_{2}\\{e}_{3}\\{e}_{4}\\{e}_{5}\\{e}_{6}\\{e}_{7}\\{e}_{8}\\{e}_{9}\\{e}_{10}\\{e}_{11}\\{e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>Now we can rephrase our model as:</p>
<div class="math notranslate nohighlight">
\[
\yvec = b \xvec + c + \evec
\]</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">sy_b</span><span class="p">,</span> <span class="n">sy_c</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;b, c&#39;</span><span class="p">)</span>
<span class="n">sy_c_mat</span> <span class="o">=</span> <span class="n">MatrixSymbol</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="n">MatAdd</span><span class="p">(</span><span class="n">MatMul</span><span class="p">(</span><span class="n">sy_b</span><span class="p">,</span> <span class="n">sy_x_val</span><span class="p">),</span> <span class="n">sy_c_mat</span><span class="p">,</span> <span class="n">sy_e_val</span><span class="p">)</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = b \left[\begin{matrix}{x}_{1}\\{x}_{2}\\{x}_{3}\\{x}_{4}\\{x}_{5}\\{x}_{6}\\{x}_{7}\\{x}_{8}\\{x}_{9}\\{x}_{10}\\{x}_{11}\\{x}_{12}\end{matrix}\right] + c + \left[\begin{matrix}{e}_{1}\\{e}_{2}\\{e}_{3}\\{e}_{4}\\{e}_{5}\\{e}_{6}\\{e}_{7}\\{e}_{8}\\{e}_{9}\\{e}_{10}\\{e}_{11}\\{e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>Bear with with us for a little trick. We define <span class="math notranslate nohighlight">\(\vec{o}\)</span> as a vector of ones,
like this:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">sy_o</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\vec</span><span class="si">{o}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">sy_o_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vector_indices</span><span class="p">])</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_o</span><span class="p">,</span> <span class="n">sy_o_val</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \vec{o} = \left[\begin{matrix}1\\1\\1\\1\\1\\1\\1\\1\\1\\1\\1\\1\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>Now we can rewrite the formula as:</p>
<div class="math notranslate nohighlight">
\[
\yvec = b\xvec + c\vec{o} + \evec
\]</div>
<p>because <span class="math notranslate nohighlight">\(o_i = 1\)</span> and so <span class="math notranslate nohighlight">\(co_i = c\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="n">MatAdd</span><span class="p">(</span><span class="n">MatMul</span><span class="p">(</span><span class="n">sy_b</span><span class="p">,</span> <span class="n">sy_x_val</span><span class="p">),</span> <span class="n">MatMul</span><span class="p">(</span><span class="n">sy_c</span><span class="p">,</span> <span class="n">sy_o_val</span><span class="p">),</span> <span class="n">sy_e_val</span><span class="p">)</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = b \left[\begin{matrix}{x}_{1}\\{x}_{2}\\{x}_{3}\\{x}_{4}\\{x}_{5}\\{x}_{6}\\{x}_{7}\\{x}_{8}\\{x}_{9}\\{x}_{10}\\{x}_{11}\\{x}_{12}\end{matrix}\right] + c \left[\begin{matrix}1\\1\\1\\1\\1\\1\\1\\1\\1\\1\\1\\1\end{matrix}\right] + \left[\begin{matrix}{e}_{1}\\{e}_{2}\\{e}_{3}\\{e}_{4}\\{e}_{5}\\{e}_{6}\\{e}_{7}\\{e}_{8}\\{e}_{9}\\{e}_{10}\\{e}_{11}\\{e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>This evaluates to the result we intend:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">sy_c</span> <span class="o">*</span> <span class="n">sy_o_val</span> <span class="o">+</span> <span class="n">sy_b</span> <span class="o">*</span> <span class="n">sy_x_val</span> <span class="o">+</span> <span class="n">sy_e_val</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = \left[\begin{matrix}c + b {x}_{1} + {e}_{1}\\c + b {x}_{2} + {e}_{2}\\c + b {x}_{3} + {e}_{3}\\c + b {x}_{4} + {e}_{4}\\c + b {x}_{5} + {e}_{5}\\c + b {x}_{6} + {e}_{6}\\c + b {x}_{7} + {e}_{7}\\c + b {x}_{8} + {e}_{8}\\c + b {x}_{9} + {e}_{9}\\c + b {x}_{10} + {e}_{10}\\c + b {x}_{11} + {e}_{11}\\c + b {x}_{12} + {e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(\newcommand{Xmat}{\boldsymbol X} \newcommand{\bvec}{\vec{\beta}}\)</span></p>
<p>We can now rephrase the calculation in terms of matrix multiplication.</p>
<p>Call <span class="math notranslate nohighlight">\(\Xmat\)</span> the matrix of two columns, where the first column is <span class="math notranslate nohighlight">\(\xvec\)</span> and
the second column is the column of ones (<span class="math notranslate nohighlight">\(\vec{o}\)</span> above). Call <span class="math notranslate nohighlight">\(\bvec\)</span> the
column vector:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left[
\begin{array}{\bvec}
b \\
c \\
\end{array}
\right]
\end{split}\]</div>
<p>This gives us exactly the same calculation as <span class="math notranslate nohighlight">\(\yvec = b \xvec + c + \evec\)</span>
above, but in terms of matrix multiplication:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">sy_beta_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">sy_b</span><span class="p">],</span> <span class="p">[</span><span class="n">sy_c</span><span class="p">]])</span>
<span class="n">sy_xmat_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">sy_x_val</span><span class="p">,</span> <span class="n">sy_o_val</span><span class="p">)</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">(</span><span class="n">MatMul</span><span class="p">(</span><span class="n">sy_xmat_val</span><span class="p">,</span> <span class="n">sy_beta_val</span><span class="p">),</span> <span class="n">sy_e_val</span><span class="p">),</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = \left[\begin{matrix}{x}_{1} &amp; 1\\{x}_{2} &amp; 1\\{x}_{3} &amp; 1\\{x}_{4} &amp; 1\\{x}_{5} &amp; 1\\{x}_{6} &amp; 1\\{x}_{7} &amp; 1\\{x}_{8} &amp; 1\\{x}_{9} &amp; 1\\{x}_{10} &amp; 1\\{x}_{11} &amp; 1\\{x}_{12} &amp; 1\end{matrix}\right] \left[\begin{matrix}b\\c\end{matrix}\right] + \left[\begin{matrix}{e}_{1}\\{e}_{2}\\{e}_{3}\\{e}_{4}\\{e}_{5}\\{e}_{6}\\{e}_{7}\\{e}_{8}\\{e}_{9}\\{e}_{10}\\{e}_{11}\\{e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>In symbols:</p>
<div class="math notranslate nohighlight">
\[
\yvec = \Xmat \bvec + \evec
\]</div>
<p>Because of the way that matrix multiplication works, this again gives us the
intended result:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">sy_xmat_val</span> <span class="o">@</span> <span class="n">sy_beta_val</span> <span class="o">+</span> <span class="n">sy_e_val</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = \left[\begin{matrix}c + b {x}_{1} + {e}_{1}\\c + b {x}_{2} + {e}_{2}\\c + b {x}_{3} + {e}_{3}\\c + b {x}_{4} + {e}_{4}\\c + b {x}_{5} + {e}_{5}\\c + b {x}_{6} + {e}_{6}\\c + b {x}_{7} + {e}_{7}\\c + b {x}_{8} + {e}_{8}\\c + b {x}_{9} + {e}_{9}\\c + b {x}_{10} + {e}_{10}\\c + b {x}_{11} + {e}_{11}\\c + b {x}_{12} + {e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>We still haven’t found our best fitting line. But before we go further,
it might be obvious that we can easily add a new predictor here.</p>
</section>
<section id="multiple-regression">
<h2>Multiple regression<a class="headerlink" href="#multiple-regression" title="Permalink to this headline">#</a></h2>
<p>Let’s say we think that psychopathy increases with age. We add the
student’s age as another predictor:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span><span class="mf">22.5</span><span class="p">,</span>  <span class="mf">25.3</span><span class="p">,</span>  <span class="mf">24.6</span><span class="p">,</span>  <span class="mf">21.4</span><span class="p">,</span>
     <span class="mf">20.7</span><span class="p">,</span>  <span class="mf">23.3</span><span class="p">,</span>  <span class="mf">23.8</span><span class="p">,</span>  <span class="mf">21.7</span><span class="p">,</span>
     <span class="mf">21.3</span><span class="p">,</span>  <span class="mf">25.2</span><span class="p">,</span>  <span class="mf">24.6</span><span class="p">,</span>  <span class="mf">21.8</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now rename the <code class="docutils literal notranslate"><span class="pre">clammy</span></code> predictor vector from <span class="math notranslate nohighlight">\(\xvec\)</span> to
<span class="math notranslate nohighlight">\(\xvec_1\)</span>. Of course <span class="math notranslate nohighlight">\(\xvec_1\)</span> has 12 values <span class="math notranslate nohighlight">\(x_{1, 1}..x_{1,
12}\)</span>. Call the <code class="docutils literal notranslate"><span class="pre">age</span></code> predictor vector <span class="math notranslate nohighlight">\(\xvec_2\)</span>. Call the slope for
<code class="docutils literal notranslate"><span class="pre">clammy</span></code> <span class="math notranslate nohighlight">\(b_1\)</span> (slope for <span class="math notranslate nohighlight">\(\xvec_1\)</span>). Call the slope for age
<span class="math notranslate nohighlight">\(b_2\)</span> (slope for <span class="math notranslate nohighlight">\(\xvec_2\)</span>). Our model is:</p>
<div class="math notranslate nohighlight">
\[
y_i = b_1 x_{1, i} + b_2 x_{2, i} + c + e_i
\]</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">sy_b_1</span><span class="p">,</span> <span class="n">sy_b_2</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;b_1, b_2&#39;</span><span class="p">)</span>
<span class="n">sy_x_1_ind</span> <span class="o">=</span> <span class="n">IndexedBase</span><span class="p">(</span><span class="s2">&quot;x_1,&quot;</span><span class="p">)</span>
<span class="n">sy_x_1_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">sy_x_1_ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vector_indices</span><span class="p">])</span>
<span class="n">sy_x_2_ind</span> <span class="o">=</span> <span class="n">IndexedBase</span><span class="p">(</span><span class="s2">&quot;x_2,&quot;</span><span class="p">)</span>
<span class="n">sy_x_2_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">sy_x_2_ind</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vector_indices</span><span class="p">])</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">(</span><span class="n">MatMul</span><span class="p">(</span><span class="n">sy_b_1</span><span class="p">,</span> <span class="n">sy_x_1_val</span><span class="p">),</span> <span class="n">MatMul</span><span class="p">(</span><span class="n">sy_b_2</span><span class="p">,</span> <span class="n">sy_x_2_val</span><span class="p">),</span> <span class="n">sy_c_mat</span><span class="p">,</span> <span class="n">sy_e_val</span><span class="p">),</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = b_{1} \left[\begin{matrix}{x_{1,}}_{1}\\{x_{1,}}_{2}\\{x_{1,}}_{3}\\{x_{1,}}_{4}\\{x_{1,}}_{5}\\{x_{1,}}_{6}\\{x_{1,}}_{7}\\{x_{1,}}_{8}\\{x_{1,}}_{9}\\{x_{1,}}_{10}\\{x_{1,}}_{11}\\{x_{1,}}_{12}\end{matrix}\right] + b_{2} \left[\begin{matrix}{x_{2,}}_{1}\\{x_{2,}}_{2}\\{x_{2,}}_{3}\\{x_{2,}}_{4}\\{x_{2,}}_{5}\\{x_{2,}}_{6}\\{x_{2,}}_{7}\\{x_{2,}}_{8}\\{x_{2,}}_{9}\\{x_{2,}}_{10}\\{x_{2,}}_{11}\\{x_{2,}}_{12}\end{matrix}\right] + c + \left[\begin{matrix}{e}_{1}\\{e}_{2}\\{e}_{3}\\{e}_{4}\\{e}_{5}\\{e}_{6}\\{e}_{7}\\{e}_{8}\\{e}_{9}\\{e}_{10}\\{e}_{11}\\{e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>In this model <span class="math notranslate nohighlight">\(\Xmat\)</span> has three columns (<span class="math notranslate nohighlight">\(\xvec_1\)</span>, <span class="math notranslate nohighlight">\(\xvec_2\)</span> and ones), and
the <span class="math notranslate nohighlight">\(\bvec\)</span> vector has three values <span class="math notranslate nohighlight">\(b_1, b_2, c\)</span>. This gives the same matrix
formulation, with our new <span class="math notranslate nohighlight">\(\Xmat\)</span> and <span class="math notranslate nohighlight">\(\bvec\)</span>: <span class="math notranslate nohighlight">\(\yvec = \Xmat \bvec + \evec\)</span>.</p>
<p>This is a <em>linear</em> model because our model says that the data <span class="math notranslate nohighlight">\(y_i\)</span> comes
from the <em>sum</em> of some components (<span class="math notranslate nohighlight">\(b_1 x_{1, i}, b_2 x_{2, i}, c, e_i\)</span>).</p>
<p>We can keep doing this by adding more and more regressors. In general, a linear
model with <span class="math notranslate nohighlight">\(p\)</span> predictors looks like this:</p>
<div class="math notranslate nohighlight">
\[
y_i = b_1 x_{1, i} + b_2 x_{2, i} + ... b_p x_{p, i} + e_i
\]</div>
<p>In the case of the models above, the final predictor <span class="math notranslate nohighlight">\(\xvec_p\)</span> would be a
column of ones, to express the intercept in the model.</p>
<p>Any model of the form above can still be phrased in the matrix form:</p>
<div class="math notranslate nohighlight">
\[
\yvec = \Xmat \bvec + \evec
\]</div>
<p>where:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">sy_xmat3_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">sy_x_1_val</span><span class="p">,</span> <span class="n">sy_x_2_val</span><span class="p">,</span> <span class="n">sy_o_val</span><span class="p">)</span>
<span class="n">sy_Xmat</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\boldsymbol</span><span class="si">{X}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_Xmat</span><span class="p">,</span> <span class="n">sy_xmat3_val</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \boldsymbol{X} = \left[\begin{matrix}{x_{1,}}_{1} &amp; {x_{2,}}_{1} &amp; 1\\{x_{1,}}_{2} &amp; {x_{2,}}_{2} &amp; 1\\{x_{1,}}_{3} &amp; {x_{2,}}_{3} &amp; 1\\{x_{1,}}_{4} &amp; {x_{2,}}_{4} &amp; 1\\{x_{1,}}_{5} &amp; {x_{2,}}_{5} &amp; 1\\{x_{1,}}_{6} &amp; {x_{2,}}_{6} &amp; 1\\{x_{1,}}_{7} &amp; {x_{2,}}_{7} &amp; 1\\{x_{1,}}_{8} &amp; {x_{2,}}_{8} &amp; 1\\{x_{1,}}_{9} &amp; {x_{2,}}_{9} &amp; 1\\{x_{1,}}_{10} &amp; {x_{2,}}_{10} &amp; 1\\{x_{1,}}_{11} &amp; {x_{2,}}_{11} &amp; 1\\{x_{1,}}_{12} &amp; {x_{2,}}_{12} &amp; 1\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>and therefore:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">sy_beta2_val</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">sy_b_1</span><span class="p">,</span> <span class="n">sy_b_2</span><span class="p">,</span> <span class="n">sy_c</span><span class="p">])</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">(</span><span class="n">MatMul</span><span class="p">(</span><span class="n">sy_xmat3_val</span><span class="p">,</span> <span class="n">sy_beta2_val</span><span class="p">),</span> <span class="n">sy_e_val</span><span class="p">),</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = \left[\begin{matrix}{x_{1,}}_{1} &amp; {x_{2,}}_{1} &amp; 1\\{x_{1,}}_{2} &amp; {x_{2,}}_{2} &amp; 1\\{x_{1,}}_{3} &amp; {x_{2,}}_{3} &amp; 1\\{x_{1,}}_{4} &amp; {x_{2,}}_{4} &amp; 1\\{x_{1,}}_{5} &amp; {x_{2,}}_{5} &amp; 1\\{x_{1,}}_{6} &amp; {x_{2,}}_{6} &amp; 1\\{x_{1,}}_{7} &amp; {x_{2,}}_{7} &amp; 1\\{x_{1,}}_{8} &amp; {x_{2,}}_{8} &amp; 1\\{x_{1,}}_{9} &amp; {x_{2,}}_{9} &amp; 1\\{x_{1,}}_{10} &amp; {x_{2,}}_{10} &amp; 1\\{x_{1,}}_{11} &amp; {x_{2,}}_{11} &amp; 1\\{x_{1,}}_{12} &amp; {x_{2,}}_{12} &amp; 1\end{matrix}\right] \left[\begin{matrix}b_{1}\\b_{2}\\c\end{matrix}\right] + \left[\begin{matrix}{e}_{1}\\{e}_{2}\\{e}_{3}\\{e}_{4}\\{e}_{5}\\{e}_{6}\\{e}_{7}\\{e}_{8}\\{e}_{9}\\{e}_{10}\\{e}_{11}\\{e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>As we were hoping, this evaluates to:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore this cell.</span>
<span class="n">Eq</span><span class="p">(</span><span class="n">sy_y_val</span><span class="p">,</span> <span class="n">sy_xmat3_val</span> <span class="o">@</span> <span class="n">sy_beta2_val</span> <span class="o">+</span> <span class="n">sy_e_val</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}{y}_{1}\\{y}_{2}\\{y}_{3}\\{y}_{4}\\{y}_{5}\\{y}_{6}\\{y}_{7}\\{y}_{8}\\{y}_{9}\\{y}_{10}\\{y}_{11}\\{y}_{12}\end{matrix}\right] = \left[\begin{matrix}c + b_{1} {x_{1,}}_{1} + b_{2} {x_{2,}}_{1} + {e}_{1}\\c + b_{1} {x_{1,}}_{2} + b_{2} {x_{2,}}_{2} + {e}_{2}\\c + b_{1} {x_{1,}}_{3} + b_{2} {x_{2,}}_{3} + {e}_{3}\\c + b_{1} {x_{1,}}_{4} + b_{2} {x_{2,}}_{4} + {e}_{4}\\c + b_{1} {x_{1,}}_{5} + b_{2} {x_{2,}}_{5} + {e}_{5}\\c + b_{1} {x_{1,}}_{6} + b_{2} {x_{2,}}_{6} + {e}_{6}\\c + b_{1} {x_{1,}}_{7} + b_{2} {x_{2,}}_{7} + {e}_{7}\\c + b_{1} {x_{1,}}_{8} + b_{2} {x_{2,}}_{8} + {e}_{8}\\c + b_{1} {x_{1,}}_{9} + b_{2} {x_{2,}}_{9} + {e}_{9}\\c + b_{1} {x_{1,}}_{10} + b_{2} {x_{2,}}_{10} + {e}_{10}\\c + b_{1} {x_{1,}}_{11} + b_{2} {x_{2,}}_{11} + {e}_{11}\\c + b_{1} {x_{1,}}_{12} + b_{2} {x_{2,}}_{12} + {e}_{12}\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<section id="population-sample-estimate">
<h3>Population, sample, estimate<a class="headerlink" href="#population-sample-estimate" title="Permalink to this headline">#</a></h3>
<p><span class="math notranslate nohighlight">\(\newcommand{\bhat}{\hat{\bvec}} \newcommand{\yhat}{\hat{\yvec}}\)</span>
Our students and their psychopathy scores are a <em>sample</em> from the
population of all students’ psychopathy scores. The parameters
<span class="math notranslate nohighlight">\(\bvec\)</span> are the parameters that fit the design <span class="math notranslate nohighlight">\(\Xmat\)</span> to
the <em>population</em> scores. We only have a sample from this population, so
we cannot get the true population <span class="math notranslate nohighlight">\(\bvec\)</span> vector, we can only
<em>estimate</em> <span class="math notranslate nohighlight">\(\bvec\)</span> from our sample. We will write this sample
estimate as <span class="math notranslate nohighlight">\(\bhat\)</span> to distinguish it from the true population
parameters <span class="math notranslate nohighlight">\(\bvec\)</span>.</p>
</section>
</section>
<section id="solving-the-model-with-matrix-algebra">
<h2>Solving the model with matrix algebra<a class="headerlink" href="#solving-the-model-with-matrix-algebra" title="Permalink to this headline">#</a></h2>
<p>The reason to formulate our problem with matrices is so we can use some
basic matrix algebra to estimate the “best” line.</p>
<p>Let’s assume that we want an estimate for the line parameters (intercept
and slope) that gives the smallest “distance” between the estimated
values (predicted from the line), and the actual values (the data).</p>
<p>We’ll define ‘distance’ as the squared difference of the predicted value from
the actual value. These are the squared error terms <span class="math notranslate nohighlight">\(e_1^2, e_2^2 ... e_{n}^2\)</span>,
where <span class="math notranslate nohighlight">\(n\)</span> is the number of observations; 12 in our case.</p>
<p>As a reminder: our model is:</p>
<div class="math notranslate nohighlight">
\[
\yvec = \Xmat \bvec + \evec
\]</div>
<p>Where <span class="math notranslate nohighlight">\(\yvec\)</span> is the data vector <span class="math notranslate nohighlight">\(y_1, y_2, ... y_n\)</span>,
<span class="math notranslate nohighlight">\(\Xmat\)</span> is the design matrix of shape <span class="math notranslate nohighlight">\(n, p\)</span>, <span class="math notranslate nohighlight">\(\bvec\)</span>
is the parameter vector, <span class="math notranslate nohighlight">\(b_1, b_2 ... b_p\)</span>, and <span class="math notranslate nohighlight">\(\evec\)</span> is
the error vector giving errors for each observation
<span class="math notranslate nohighlight">\(\epsilon_1, \epsilon_2 ... \epsilon_n\)</span>.</p>
<p>Each column of <span class="math notranslate nohighlight">\(\Xmat\)</span> is a regressor vector, so <span class="math notranslate nohighlight">\(\Xmat\)</span> can
be thought of as the column concatenation of <span class="math notranslate nohighlight">\(p\)</span> vectors
<span class="math notranslate nohighlight">\(\xvec_1, \xvec_2 ... \xvec_p\)</span>, where <span class="math notranslate nohighlight">\(\xvec_1\)</span> is the first
regressor <em>vector</em>, and so on.</p>
<p>In our case, we want an estimate <span class="math notranslate nohighlight">\(\bhat\)</span> for the vector
<span class="math notranslate nohighlight">\(\bvec\)</span> such that the errors <span class="math notranslate nohighlight">\(\evec = \yvec - \Xmat \bhat\)</span>
have the smallest sum of squares <span class="math notranslate nohighlight">\(\sum_{i=1}^n{e_i^2}\)</span>.
<span class="math notranslate nohighlight">\(\sum_{i=1}^n{e_i^2}\)</span> is called the <em>residual sum of squares</em>.</p>
<p>When we have our <span class="math notranslate nohighlight">\(\bhat\)</span> estimate, then the prediction of the data
from the estimate is given by <span class="math notranslate nohighlight">\(\Xmat \bhat\)</span>.</p>
<p>We call this the predicted or estimated data, and write it as
<span class="math notranslate nohighlight">\(\yhat\)</span>. The errors are then given by <span class="math notranslate nohighlight">\(\yvec - \yhat\)</span>.</p>
<p>We might expect that, when we have found the right <span class="math notranslate nohighlight">\(\bhat\)</span> then the errors
will have nothing in them that can still be explained by the design matrix
<span class="math notranslate nohighlight">\(\Xmat\)</span>. This is the same as saying that, when we have best prediction of the
data (<span class="math notranslate nohighlight">\(\yhat = \Xmat \bhat\)</span>), the design matrix <span class="math notranslate nohighlight">\(\Xmat\)</span> should be orthogonal
to the remaining error (<span class="math notranslate nohighlight">\(\yvec - \yhat\)</span>). If the design is orthogonal to the
errors, then <span class="math notranslate nohighlight">\(\Xmat^T \evec\)</span> should be a vector of zeros.</p>
<p>If that is the case then we can multiply
<span class="math notranslate nohighlight">\(\yvec = \Xmat \bhat + \evec\)</span> through by <span class="math notranslate nohighlight">\(\Xmat^T\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\Xmat^T \yvec = \Xmat^T \Xmat \bhat + \Xmat^T \evec
\]</div>
<p>The last term now disappears because it is zero and:</p>
<div class="math notranslate nohighlight">
\[
\Xmat^T \yvec = \Xmat^T \Xmat \bhat
\]</div>
<p>If <span class="math notranslate nohighlight">\(\Xmat^T \Xmat\)</span> is invertible (has a matrix inverse
<span class="math notranslate nohighlight">\((\Xmat^T \Xmat)^{-1}\)</span>) then there is a unique solution:</p>
<div class="math notranslate nohighlight">
\[
\bhat = (\Xmat^T \Xmat)^{-1} \Xmat^T \yvec
\]</div>
<p>It turns out that, if <span class="math notranslate nohighlight">\(\Xmat^T \Xmat\)</span> is not invertible, there are
an infinite number of solutions, and we have to choose one solution,
taking into account that the parameters <span class="math notranslate nohighlight">\(\bhat\)</span> will depend on
which solution we chose. The <em>pseudoinverse</em> operator gives us one
particular solution. If <span class="math notranslate nohighlight">\(\bf{A}^+\)</span> is the pseudoinverse of matrix
<span class="math notranslate nohighlight">\(\bf{A}\)</span> then the general solution for <span class="math notranslate nohighlight">\(\bhat\)</span>, even when
<span class="math notranslate nohighlight">\(\Xmat^T \Xmat\)</span> is not invertible, is:</p>
<div class="math notranslate nohighlight">
\[
\bhat = \Xmat^+ \yvec
\]</div>
<p>Using this matrix algebra, what line do we estimate for <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code>
and <code class="docutils literal notranslate"><span class="pre">clammy</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">clammy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span>
<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.389, 1.   ],
       [0.2  , 1.   ],
       [0.241, 1.   ],
       [0.463, 1.   ],
       [4.585, 1.   ],
       [1.097, 1.   ],
       [1.642, 1.   ],
       [4.972, 1.   ],
       [7.957, 1.   ],
       [5.585, 1.   ],
       [5.527, 1.   ],
       [6.964, 1.   ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the pseudoinverse to get estimated B</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">npl</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="n">psychopathy</span>
<span class="n">B</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.999257, 10.071286])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clammy</span><span class="p">,</span> <span class="n">psychopathy</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f839ce29040&gt;]
</pre></div>
</div>
<img alt="_images/glm_intro_51_1.png" src="_images/glm_intro_51_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_slope</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">best_intercept</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">best_predictions</span> <span class="o">=</span> <span class="n">best_intercept</span> <span class="o">+</span> <span class="n">best_slope</span> <span class="o">*</span> <span class="n">clammy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the new prediction</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clammy</span><span class="p">,</span> <span class="n">psychopathy</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clammy</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best predictions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Clamminess of handshake&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Psychopathy score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Clammy vs psychopathy with best line&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/glm_intro_53_0.png" src="_images/glm_intro_53_0.png" />
</div>
</div>
<p>Our claim was that this estimate for slope and intercept minimize the sum (and
therefore mean) of squared error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fitted</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">B</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">psychopathy</span> <span class="o">-</span> <span class="n">fitted</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">errors</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>252.92560644993824
</pre></div>
</div>
</div>
</div>
<p>Is this sum of squared errors smaller than our earlier guess of an intercept of
10 and a slope of 0.9?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fitted</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">psychopathy</span> <span class="o">-</span> <span class="n">fitted</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">errors</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>255.75076072
</pre></div>
</div>
</div>
</div>
</section>
<section id="contrasts">
<h2>Contrasts<a class="headerlink" href="#contrasts" title="Permalink to this headline">#</a></h2>
<p><span class="math notranslate nohighlight">\(\newcommand{cvec}{\mathbf{c}}\)</span> We can combine the values in the
<span class="math notranslate nohighlight">\(\bhat\)</span> vector in different ways by using a <em>contrast</em> vector. A
contrast vector <span class="math notranslate nohighlight">\(\cvec\)</span> is a vector of weights
<span class="math notranslate nohighlight">\(c_1, c_2 ... c_p\)</span> for each value in the <span class="math notranslate nohighlight">\(\bhat\)</span> vector.
Assume that all vectors we have defined up until now are column vectors. Then
a scalar value that is a linear combination of the <span class="math notranslate nohighlight">\(\bhat\)</span> values can be
written:</p>
<div class="math notranslate nohighlight">
\[
\cvec^T \bhat
\]</div>
<p>We now return to our original question, whether clamminess of handshake
predicts psychopathy score.</p>
<p>If clamminess does predict psychopathy, then we would expect the slope
of the best fit line between <code class="docutils literal notranslate"><span class="pre">clammy</span></code> and <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code> would be
different from zero.</p>
<p>In our model, we have two predictors, the column of ones and <code class="docutils literal notranslate"><span class="pre">clammy</span></code>.
<span class="math notranslate nohighlight">\(p = 2\)</span> and <span class="math notranslate nohighlight">\(\bhat\)</span> is length 2. We could choose just the first of
the values in <span class="math notranslate nohighlight">\(\bhat\)</span> with a contrast:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left[
\begin{array}{\cvec}
1 \\
0 \\
\end{array}
\right]
\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(\cvec^T \bhat\)</span> with this contrast gives our <em>estimate</em> of the
slope relating <code class="docutils literal notranslate"><span class="pre">clammy</span></code> to <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code>. Now we might be interested
if our estimate is further from zero than expected by chance.</p>
<p>To test whether the estimate is different from zero, we can divide the estimate
by the variability of the estimate. This gives us an idea of how far the
estimate is from zero, in terms of the variability of the estimate. We won’t go
into the estimate of the variability here though, we’ll just assume it (the
formula is in the code below). The estimate divided by the variability of the
estimate gives us a t statistic.</p>
<p>With that introduction, here’s how to do the estimation and a t statistic given
the data <span class="math notranslate nohighlight">\(\yvec\)</span>, the design <span class="math notranslate nohighlight">\(\Xmat\)</span>, and a contrast vector
<span class="math notranslate nohighlight">\(\cvec\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get t distribution code from scipy library</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span> <span class="k">as</span> <span class="n">t_dist</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">t_stat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; betas, t statistic and significance test given data, design matrix, contrast</span>

<span class="sd">    This is Ordinary Least Square estimation; we assume the errors to have</span>
<span class="sd">    independent and identical normal distributions around zero for each $i$ in</span>
<span class="sd">    $\e_i$ (i.i.d).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make sure y, X, c are all arrays</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># As column vector</span>
    <span class="c1"># Calculate the parameters - b hat</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">npl</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="n">y</span>
    <span class="c1"># The fitted values - y hat</span>
    <span class="n">fitted</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">beta</span>
    <span class="c1"># Residual error</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">fitted</span>
    <span class="c1"># Residual sum of squares</span>
    <span class="n">RSS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">errors</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Degrees of freedom is the number of observations n minus the number</span>
    <span class="c1"># of independent regressors we have used.  If all the regressor</span>
    <span class="c1"># columns in X are independent then the (matrix rank of X) == p</span>
    <span class="c1"># (where p the number of columns in X). If there is one column that</span>
    <span class="c1"># can be expressed as a linear sum of the other columns then</span>
    <span class="c1"># (matrix rank of X) will be p - 1 - and so on.</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">npl</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="c1"># Mean residual sum of squares</span>
    <span class="n">MRSS</span> <span class="o">=</span> <span class="n">RSS</span> <span class="o">/</span> <span class="n">df</span>
    <span class="c1"># calculate bottom half of t statistic</span>
    <span class="n">SE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MRSS</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">npl</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">beta</span> <span class="o">/</span> <span class="n">SE</span>
    <span class="c1"># Get p value for t value using cumulative density function</span>
    <span class="c1"># (CDF) of the t distribution.</span>
    <span class="n">ltp</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="c1"># lower tail p</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ltp</span> <span class="c1"># upper tail p</span>
    <span class="k">return</span> <span class="n">beta</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<p>See <a class="reference external" href="https://matthew-brett.github.io/teaching/on_cdfs.html">p values from cumulative distribution
functions</a> for
background on the probability values.</p>
<p>So, does <code class="docutils literal notranslate"><span class="pre">clammy</span></code> predict <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code>? If it does not, then our
estimate of the slope will not be convincingly different from 0. The t
test divides our estimate of the slope by the error in the estimate;
large values mean that the slope is large compared to the error in the
estimate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">clammy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">psychopathy</span><span class="p">)</span>
<span class="n">B</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">t_stat</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[1.914389]]), array([[0.042295]]))
</pre></div>
</div>
</div>
</div>
</section>
<section id="dummy-coding-and-the-general-linear-model">
<span id="dummy-coding"></span><h2>Dummy coding and the general linear model<a class="headerlink" href="#dummy-coding-and-the-general-linear-model" title="Permalink to this headline">#</a></h2>
<p>So far we have been doing <em>multiple regression</em>. That is, all the columns
(except the column of ones) are continuous vectors of numbers predicting our
outcome data <code class="docutils literal notranslate"><span class="pre">psychopathy</span></code>. These type of predictors are often called
<em>covariates</em>.</p>
<p>It turns out we can use this same framework to express the fact that different
observations come from different groups.</p>
<p>Expressing group membership in this way allows us to express <em>analysis
of variance</em> designs using this same notation.</p>
<p>To do this, we use columns of <em>dummy variables</em>.</p>
<p>Let’s say we get some new and interesting information. The first 4
students come from Berkeley, the second set of 4 come from Stanford, and
the last set of 4 come from MIT. Maybe the student’s college predicts if
they are a psychopath?</p>
<p>How do we express this information? Let’s forget about the clamminess
score for now and just use the school information. Our model might be
that we can best predict the psychopathy scores by approximating the
individual student psychopathy scores with a mean score for the relevant
school:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
y_i = \mu_{Berkeley} + e_i  \space\mbox{if}\space 1 \le i \le 4 \\
y_i = \mu_{Stanford} + e_i \space\mbox{if}\space 5 \le i \le 8 \\
y_i = \mu_{MIT} + e_i \space\mbox{if}\space 9 \le i \le 12
\end{split}\]</div>
<p>We can code this with predictors in our design using <em>indicator
variables</em>. The “Berkeley” indicator variable vector is 1 when the
student is from Berkeley and zero otherwise. Similarly for the other two
schools:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">berkeley_indicator</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">stanford_indicator</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">mit_indicator</span>      <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">berkeley_indicator</span><span class="p">,</span>
                    <span class="n">stanford_indicator</span><span class="p">,</span>
                    <span class="n">mit_indicator</span><span class="p">))</span>
<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1, 0, 0],
       [1, 0, 0],
       [1, 0, 0],
       [1, 0, 0],
       [0, 1, 0],
       [0, 1, 0],
       [0, 1, 0],
       [0, 1, 0],
       [0, 0, 1],
       [0, 0, 1],
       [0, 0, 1],
       [0, 0, 1]])
</pre></div>
</div>
</div>
</div>
<p>These indicator columns are <em>dummy variables</em> where the values code for
the group membership.</p>
<p>Now the <span class="math notranslate nohighlight">\(\bvec\)</span> vector will be:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left[
\begin{array}{\bvec}
\mu_{Berkeley} \\
\mu_{Stanford} \\
\mu_{MIT} \\
\end{array}
\right]
\end{split}\]</div>
<p>When we estimate these using the least squares method, what estimates
will we get for <span class="math notranslate nohighlight">\(\bhat\)</span>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">npl</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">@</span> <span class="n">psychopathy</span>
<span class="n">B</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([10.74225, 11.3355 , 18.03425])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Berkeley mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">psychopathy</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stanford mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">psychopathy</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MIT mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">psychopathy</span><span class="p">[</span><span class="mi">8</span><span class="p">:]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Berkeley mean: 10.74225
Stanford mean: 11.3355
MIT mean: 18.03425
</pre></div>
</div>
</div>
</div>
<p>It looks like the MIT students are a bit more psychopathic. Are they more
psychopathic than Berkeley and Stanford?</p>
<p>We can use a contrast to test whether the mean for the MIT students is greater
than the mean of (mean for Berkeley, mean for Stanford):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">t_stat</span><span class="p">(</span><span class="n">psychopathy</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[2.340356]]), array([[0.021997]]))
</pre></div>
</div>
</div>
</div>
<p>Ah — yes — just as we suspected.</p>
<p>The model above expresses the effect of group membership. It is the
expression of a one-way analysis of variance (ANOVA) model using
<span class="math notranslate nohighlight">\(\yvec = \Xmat \bvec + \evec\)</span>.</p>
</section>
<section id="ancova-in-the-general-linear-model">
<h2>ANCOVA in the General Linear Model<a class="headerlink" href="#ancova-in-the-general-linear-model" title="Permalink to this headline">#</a></h2>
<p>Our formulation <span class="math notranslate nohighlight">\(\yvec = \Xmat \bvec + \evec\)</span> makes it very easy
to add extra regressors to models with group membership. For example, we
can easily make a simple ANCOVA model (analysis of covariance).</p>
<p>ANCOVA is a specific term for the case where we have a model with both
group membership (ANOVA model) and one or more continuous covariates.</p>
<p>For example, we can add back our clamminess score to the mix. Does it
explain anything once we know which school the student is at?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">berkeley_indicator</span><span class="p">,</span>
                     <span class="n">stanford_indicator</span><span class="p">,</span>
                     <span class="n">mit_indicator</span><span class="p">,</span>
                     <span class="n">clammy</span><span class="p">))</span>
<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1.   , 0.   , 0.   , 0.389],
       [1.   , 0.   , 0.   , 0.2  ],
       [1.   , 0.   , 0.   , 0.241],
       [1.   , 0.   , 0.   , 0.463],
       [0.   , 1.   , 0.   , 4.585],
       [0.   , 1.   , 0.   , 1.097],
       [0.   , 1.   , 0.   , 1.642],
       [0.   , 1.   , 0.   , 4.972],
       [0.   , 0.   , 1.   , 7.957],
       [0.   , 0.   , 1.   , 5.585],
       [0.   , 0.   , 1.   , 5.527],
       [0.   , 0.   , 1.   , 6.964]])
</pre></div>
</div>
</div>
</div>
<p>We test the independent effect of the clamminess score with a contrast
on the clammy slope parameter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">t_stat</span><span class="p">(</span><span class="n">psychopathy</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[-0.010661]]), array([[0.504122]]))
</pre></div>
</div>
</div>
</div>
<p>It looks like there’s not much independent effect of clamminess. The MIT
students seem to have clammy hands, and once we know that the student is
from MIT, the clammy score is not as useful.</p>
</section>
<section id="displaying-the-design-matrix-as-an-image">
<h2>Displaying the design matrix as an image<a class="headerlink" href="#displaying-the-design-matrix-as-an-image" title="Permalink to this headline">#</a></h2>
<p>We can show the design as an image, by scaling the values with columns.</p>
<p>We scale within columns because we care more about seeing variation
within the regressor than between regressors. For example, if we have a
regressor varying between 0 and 1, and another between 0 and 1000,
without scaling, the column with the larger numbers will swamp the
variation in the column with the smaller numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale_design_mtx</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;utility to scale the design matrix for display</span>

<span class="sd">    This scales the columns to their own range so we can see the variations</span>
<span class="sd">    across the column for all the columns, regardless of the scaling of the</span>
<span class="sd">    column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mi</span><span class="p">,</span> <span class="n">ma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Vector that is True for columns where values are not</span>
    <span class="c1"># all almost equal to each other</span>
    <span class="n">col_neq</span> <span class="o">=</span> <span class="p">(</span><span class="n">ma</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e-8</span>
    <span class="n">Xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="c1"># Leave columns with same value throughout with 1s</span>
    <span class="c1"># Scale other columns to min, max in column</span>
    <span class="n">mi</span> <span class="o">=</span> <span class="n">mi</span><span class="p">[</span><span class="n">col_neq</span><span class="p">]</span>
    <span class="n">ma</span> <span class="o">=</span> <span class="n">ma</span><span class="p">[</span><span class="n">col_neq</span><span class="p">]</span>
    <span class="n">Xs</span><span class="p">[:,</span><span class="n">col_neq</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="n">col_neq</span><span class="p">]</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ma</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Xs</span>
</pre></div>
</div>
</div>
</div>
<p>Then we can display this scaled design with a title and some default
image display parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_design</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">design_title</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Show the design matrix nicely &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scale_design_mtx</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>
               <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
               <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span> <span class="c1"># Gray colormap</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">design_title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can then see our ANCOVA design above at a glance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_design</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s1">&#39;ANCOVA&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/glm_intro_85_0.png" src="_images/glm_intro_85_0.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "nipraxis/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="regress_one_voxel.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Regression for a single voxel</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="mean_test_example.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">A worked example of the general linear model</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The nipraxis team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>